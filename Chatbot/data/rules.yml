version: "3.1"
rules:

  - rule: responder saludo
    steps:
      - intent: saludar
      - action: utter_saludar

  - rule: ofrecer ayuda
    steps:
      - intent: ayuda
      - action: utter_info_servicios

  - rule: responder dolor o lesion
    steps:
      - intent: dolor_lesion
      - action: utter_dolor_lesion

  - rule: actualizar perfil
    steps:
      - intent: actualizar_perfil
      - action: utter_link_perfil

  - rule: rutina con perfil completo
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true
      - action: utter_perfil_resumen
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: rutina con perfil incompleto
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: false
      - action: utter_perfil_incompleto
      - action: profile_form
      - active_loop: profile_form

  - rule: dieta con perfil completo
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true
      - action: utter_perfil_resumen
      - action: action_generar_dieta
      - slot_was_set:
          - requested_plan: null

  - rule: dieta con perfil incompleto
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: false
      - action: utter_perfil_incompleto
      - action: profile_form
      - active_loop: profile_form

  - rule: iniciar captura de perfil con el bot
    steps:
      - intent: actualizar_perfil_bot
      - action: profile_form
      - active_loop: profile_form

  - rule: profile_form while active
    condition:
      - active_loop: profile_form
    steps:
      - action: profile_form
      - active_loop: profile_form
      - action: action_listen

  - rule: Activar modo demo
    steps:
      - intent: activar_modo_demo
      - slot_was_set:
          - demo_offline: true
      - slot_was_set:
          - offline_notified: false
      - action: utter_demo_on

  - rule: Desactivar modo demo
    steps:
      - intent: desactivar_modo_demo
      - slot_was_set:
          - demo_offline: false
      - slot_was_set:
          - offline_notified: false
      - action: utter_demo_off

  - rule: Mostrar capacidades
    steps:
      - intent: ayuda
      - action: utter_capabilities

  - rule: Aviso offline una sola vez en demo
    condition:
      - slot_was_set:
          - demo_offline: true
          - offline_notified: false
    steps:
      - action: utter_offline_intro
      - slot_was_set:
          - offline_notified: true

  - rule: Rutina basica en modo demo
    condition:
      - slot_was_set:
          - demo_offline: true
    steps:
      - intent: solicitar_rutina
      - action: utter_offline_routine_basic

  - rule: Dieta basica en modo demo
    condition:
      - slot_was_set:
          - demo_offline: true
    steps:
      - intent: solicitar_dieta
      - action: utter_offline_diet_basic

  - rule: Backend caido rutina basica
    condition:
      - slot_was_set:
          - backend_down: true
    steps:
      - intent: solicitar_rutina
      - action: utter_offline_routine_basic

  - rule: Backend caido dieta basica
    condition:
      - slot_was_set:
          - backend_down: true
    steps:
      - intent: solicitar_dieta
      - action: utter_offline_diet_basic

  - rule: pedir peso en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: peso
      - action: utter_ask_peso
      - intent: informar
      - action: profile_form

  - rule: pedir altura en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: altura
      - action: utter_ask_altura
      - intent: informar
      - action: profile_form

  - rule: pedir objetivo fitness en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: objetivo_fitness
      - action: utter_ask_objetivo_fitness
      - intent: informar
      - action: profile_form

  - rule: pedir somatotipo en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: somatotipo
      - action: utter_ask_somatotipo
      - intent: informar
      - action: profile_form

  - rule: pedir padecimientos en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: padecimientos
      - action: utter_ask_padecimientos
      - intent: informar
      - action: profile_form

  - rule: pedir preferencia dieta en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: preferencia_dieta
      - action: utter_ask_preferencia_dieta
      - intent: informar
      - action: profile_form

  - rule: pedir musculo preferido en profile_form
    condition:
      - active_loop: profile_form
    steps:
      - slot_was_set:
          - requested_slot: musculo_preferido
      - action: utter_ask_musculo_preferido
      - intent: informar
      - action: profile_form

  - rule: cancelar profile_form
    condition:
      - active_loop: profile_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_form_cancelado

  - rule: completar profile_form para rutina
    condition:
      - active_loop: profile_form
      - slot_was_set:
          - requested_plan: rutina
    steps:
      - action: profile_form
      - active_loop: null
      - action: action_submit_profile_form
      - action: utter_perfil_actualizado
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: completar profile_form para dieta
    condition:
      - active_loop: profile_form
      - slot_was_set:
          - requested_plan: dieta
    steps:
      - action: profile_form
      - active_loop: null
      - action: action_submit_profile_form
      - action: utter_perfil_actualizado
      - action: action_generar_dieta
      - slot_was_set:
          - requested_plan: null

  - rule: completar profile_form sin plan
    condition:
      - active_loop: profile_form
      - slot_was_set:
          - requested_plan: null
    steps:
      - action: profile_form
      - active_loop: null
      - action: action_submit_profile_form
      - action: utter_perfil_actualizado

  - rule: iniciar hero form
    steps:
      - intent: solicitar_entreno_unico
      - action: hero_form
      - active_loop: hero_form

  - rule: hero_form while active
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: hero_form
      - action: action_listen

  - rule: pedir hero programa en hero_form
    condition:
      - active_loop: hero_form
    steps:
      - slot_was_set:
          - requested_slot: hero_programa
      - action: utter_ask_hero_programa
      - intent: informar
      - action: hero_form

  - rule: pedir hero inicio en hero_form
    condition:
      - active_loop: hero_form
    steps:
      - slot_was_set:
          - requested_slot: hero_inicio
      - action: utter_ask_hero_inicio
      - intent: informar
      - action: hero_form

  - rule: pedir hero equipo en hero_form
    condition:
      - active_loop: hero_form
    steps:
      - slot_was_set:
          - requested_slot: hero_equipo
      - action: utter_ask_hero_equipo
      - intent: informar
      - action: hero_form

  - rule: cancelar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_hero_cancelado

  - rule: completar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: null
      - action: action_inscribir_entreno_unico

  - rule: soporte general
    steps:
      - intent: soporte_general
      - action: utter_soporte_opciones

  - rule: soporte mfa
    steps:
      - intent: soporte_mfa
      - action: utter_soporte_mfa

  - rule: responder faq
    steps:
      - intent: faq
      - action: utter_faq


  - rule: actualizar objetivo de rutina
    steps:
      - intent: cambiar_objetivo_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: actualizar musculo de rutina
    steps:
      - intent: cambiar_musculo_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: actualizar nivel de rutina
    steps:
      - intent: cambiar_nivel_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: mostrar rutina en pantalla
    steps:
      - intent: mostrar_rutina_pantalla
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: enviar rutina por correo pedir contacto
    steps:
      - intent: enviar_rutina_correo
      - action: utter_pedir_contacto

  - rule: enviar rutina por correo confirmar
    steps:
      - action: utter_pedir_contacto
      - intent: informar
      - action: utter_envio_rutina_correo

  - rule: consultar reserva pedir codigo
    steps:
      - intent: consultar_reserva
      - action: utter_ask_codigo_reserva

  - rule: consultar reserva responder
    steps:
      - action: utter_ask_codigo_reserva
      - intent: informar
      - action: action_consultar_reserva
      - action: utter_reserva_estado

  - rule: suscripcion alta
    steps:
      - intent: suscripcion_alta
      - action: utter_suscripcion_alta

  - rule: suscripcion baja
    steps:
      - intent: suscripcion_baja
      - action: utter_suscripcion_baja

  - rule: cambio de plan de suscripcion
    steps:
      - intent: suscripcion_cambio_plan
      - action: action_suscripcion_cambio_plan

  - rule: iniciar reserva_form
    steps:
      - intent: crear_reserva
      - action: reserva_form
      - active_loop: reserva_form

  - rule: reserva_form activa
    condition:
      - active_loop: reserva_form
    steps:
      - action: reserva_form
      - active_loop: reserva_form
      - action: action_listen

  - rule: pedir clase en reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - slot_was_set:
          - requested_slot: clase
      - action: utter_ask_clase
      - intent: informar
      - action: reserva_form

  - rule: pedir fecha en reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - slot_was_set:
          - requested_slot: fecha
      - action: utter_ask_fecha
      - intent: informar
      - action: reserva_form

  - rule: pedir hora en reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - slot_was_set:
          - requested_slot: hora
      - action: utter_ask_hora
      - intent: informar
      - action: reserva_form

  - rule: completar reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - action: reserva_form
      - active_loop: null
      - action: utter_confirmar_reserva

  - rule: cancelar reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_reserva_cancelada

  - rule: confirmar reserva positiva
    steps:
      - action: utter_confirmar_reserva
      - intent: afirmar
      - action: action_crear_reserva
      - action: utter_reserva_confirmada

  - rule: confirmar reserva negativa
    steps:
      - action: utter_confirmar_reserva
      - intent: negar
      - action: utter_reserva_cancelada

  - rule: rutina_form activa
    condition:
      - active_loop: rutina_form
    steps:
      - action: rutina_form
      - active_loop: rutina_form
      - action: action_listen

  - rule: pedir objetivo en rutina_form
    condition:
      - active_loop: rutina_form
    steps:
      - slot_was_set:
          - requested_slot: objetivo
      - action: utter_ask_objetivo
      - intent: informar
      - action: rutina_form

  - rule: pedir musculo en rutina_form
    condition:
      - active_loop: rutina_form
    steps:
      - slot_was_set:
          - requested_slot: musculo
      - action: utter_ask_musculo
      - intent: informar
      - action: rutina_form

  - rule: completar rutina_form
    condition:
      - active_loop: rutina_form
    steps:
      - action: rutina_form
      - active_loop: null
      - action: utter_resumen_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - requested_plan: null
          - servicio_pendiente: null

  - rule: abrir pagina de perfil
    steps:
      - intent: navegar_perfil_web
      - action: utter_link_perfil

  - rule: mostrar perfil
    steps:
      - intent: consultar_perfil
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true
      - action: utter_mostrar_perfil
      - action: utter_perfil_resumen

  - rule: manejar fallback
    steps:
      - intent: nlu_fallback
      - action: utter_fuera_de_alcance
