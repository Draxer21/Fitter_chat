version: "3.1"
rules:

  - rule: responder saludo
    steps:
      - intent: saludar
      - action: utter_saludar

  - rule: ofrecer ayuda
    steps:
      - intent: ayuda
      - action: utter_info_servicios

  - rule: responder dolor o lesion
    steps:
      - intent: dolor_lesion
      - action: utter_dolor_lesion

  - rule: atender solicitud de rutina
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: null

  - rule: atender solicitud de rutina con perfil incompleto
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: false

  - rule: atender solicitud de rutina con perfil completo
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true

  - rule: atender solicitud de dieta
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: null

  - rule: atender solicitud de dieta con perfil incompleto
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: false

  - rule: atender solicitud de dieta con perfil completo
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true

  - rule: consultar perfil
    steps:
      - intent: consultar_perfil
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: null

  - rule: consultar perfil incompleto
    steps:
      - intent: consultar_perfil
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: false

  - rule: consultar perfil completo
    steps:
      - intent: consultar_perfil
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: true

  - rule: actualizar perfil
    steps:
      - intent: actualizar_perfil
      - action: action_fetch_profile
      - slot_was_set:
          - perfil_completo: null

  - rule: iniciar captura de perfil con el bot
    steps:
      - intent: actualizar_perfil_bot
      - action: profile_form
      - active_loop: profile_form

  - rule: profile_form while active
    condition:
      - active_loop: profile_form
    steps:
      - action: profile_form
      - active_loop: profile_form
      - action: action_listen

  - rule: cancelar profile_form
    condition:
      - active_loop: profile_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_form_cancelado

  - rule: completar profile_form
    condition:
      - active_loop: profile_form
    steps:
      - action: profile_form
      - active_loop: null
      - action: action_submit_profile_form
      - action: action_listen

  - rule: iniciar hero form
    steps:
      - intent: solicitar_entreno_unico
      - action: hero_form
      - active_loop: hero_form

  - rule: hero_form while active
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: hero_form
      - action: action_listen

  - rule: cancelar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_hero_cancelado

  - rule: completar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: null
      - action: action_inscribir_entreno_unico

  - rule: soporte general
    steps:
      - intent: soporte_general
      - action: utter_soporte_opciones

  - rule: soporte mfa
    steps:
      - intent: soporte_mfa
      - action: utter_soporte_mfa

  - rule: actualizar objetivo de rutina
    steps:
      - intent: cambiar_objetivo_rutina
      - action: action_generar_rutina

  - rule: actualizar musculo de rutina
    steps:
      - intent: cambiar_musculo_rutina
      - action: action_generar_rutina

  - rule: actualizar nivel de rutina
    steps:
      - intent: cambiar_nivel_rutina
      - action: action_generar_rutina

  - rule: mostrar rutina en pantalla
    steps:
      - intent: mostrar_rutina_pantalla
      - action: action_generar_rutina

  - rule: cerrar flujo rutina
    steps:
      - action: action_generar_rutina
      - action: action_listen

  - rule: cerrar flujo dieta
    steps:
      - action: action_generar_dieta
      - action: action_listen

  - rule: enviar rutina por correo pedir contacto
    steps:
      - intent: enviar_rutina_correo
      - action: utter_pedir_contacto

  - rule: enviar rutina por correo confirmar
    steps:
      - action: utter_pedir_contacto
      - intent: informar
      - action: utter_envio_rutina_correo

  - rule: consultar reserva pedir codigo
    steps:
      - intent: consultar_reserva
      - action: utter_ask_codigo_reserva

  - rule: consultar reserva responder
    steps:
      - action: utter_ask_codigo_reserva
      - intent: informar
      - action: action_consultar_reserva
      - action: utter_reserva_estado

  - rule: suscripcion alta
    steps:
      - intent: suscripcion_alta
      - action: utter_suscripcion_alta

  - rule: suscripcion baja
    steps:
      - intent: suscripcion_baja
      - action: utter_suscripcion_baja

  - rule: abrir pagina de perfil
    steps:
      - intent: navegar_perfil_web
      - action: utter_link_perfil

  - rule: informacion adicional generica
    steps:
      - intent: informar
      - action: action_listen

  - rule: manejar fallback
    steps:
      - intent: nlu_fallback
      - action: utter_fuera_de_alcance
