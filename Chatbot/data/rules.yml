version: "3.1"
rules:

  - rule: responder saludo
    steps:
      - intent: saludar
      - action: utter_saludar

  - rule: ofrecer ayuda
    steps:
      - intent: ayuda
      - action: utter_info_servicios

  - rule: responder dolor o lesion
    steps:
      - intent: dolor_lesion
      - action: utter_dolor_lesion

  - rule: actualizar perfil
    steps:
      - intent: actualizar_perfil
      - action: utter_link_perfil

  - rule: iniciar rutina
    steps:
      - intent: solicitar_rutina
      - action: action_fetch_profile

  - rule: iniciar dieta
    steps:
      - intent: solicitar_dieta
      - action: action_fetch_profile

  - rule: iniciar captura de perfil con el bot
    steps:
      - intent: actualizar_perfil_bot
      - action: profile_form
      - active_loop: profile_form

  - rule: profile_form while active
    condition:
      - active_loop: profile_form
    steps:
      - action: profile_form
      - active_loop: profile_form
      - action: action_listen

  - rule: cancelar profile_form
    condition:
      - active_loop: profile_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_form_cancelado

  - rule: completar profile_form
    condition:
      - active_loop: profile_form
    steps:
      - action: profile_form
      - active_loop: null
      - action: action_submit_profile_form

  - rule: iniciar hero form
    steps:
      - intent: solicitar_entreno_unico
      - action: hero_form
      - active_loop: hero_form

  - rule: hero_form while active
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: hero_form
      - action: action_listen

  - rule: cancelar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_hero_cancelado

  - rule: completar hero_form
    condition:
      - active_loop: hero_form
    steps:
      - action: hero_form
      - active_loop: null
      - action: action_inscribir_entreno_unico

  - rule: soporte general
    steps:
      - intent: soporte_general
      - action: utter_soporte_opciones

  - rule: soporte mfa
    steps:
      - intent: soporte_mfa
      - action: utter_soporte_mfa

  - rule: actualizar objetivo de rutina
    steps:
      - intent: cambiar_objetivo_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - servicio_pendiente: null

  - rule: actualizar musculo de rutina
    steps:
      - intent: cambiar_musculo_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - servicio_pendiente: null

  - rule: actualizar nivel de rutina
    steps:
      - intent: cambiar_nivel_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - servicio_pendiente: null

  - rule: mostrar rutina en pantalla
    steps:
      - intent: mostrar_rutina_pantalla
      - action: action_generar_rutina
      - slot_was_set:
          - servicio_pendiente: null

  - rule: enviar rutina por correo pedir contacto
    steps:
      - intent: enviar_rutina_correo
      - action: utter_pedir_contacto

  - rule: enviar rutina por correo confirmar
    steps:
      - action: utter_pedir_contacto
      - intent: informar
      - action: utter_envio_rutina_correo

  - rule: consultar reserva pedir codigo
    steps:
      - intent: consultar_reserva
      - action: utter_ask_codigo_reserva

  - rule: consultar reserva responder
    steps:
      - action: utter_ask_codigo_reserva
      - intent: informar
      - action: action_consultar_reserva
      - action: utter_reserva_estado

  - rule: suscripcion alta
    steps:
      - intent: suscripcion_alta
      - action: utter_suscripcion_alta

  - rule: suscripcion baja
    steps:
      - intent: suscripcion_baja
      - action: utter_suscripcion_baja

  - rule: cambio de plan de suscripcion
    steps:
      - intent: suscripcion_cambio_plan
      - action: action_suscripcion_cambio_plan

  - rule: iniciar reserva_form
    steps:
      - intent: crear_reserva
      - action: reserva_form
      - active_loop: reserva_form

  - rule: reserva_form activa
    condition:
      - active_loop: reserva_form
    steps:
      - action: reserva_form
      - active_loop: reserva_form
      - action: action_listen

  - rule: completar reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - action: reserva_form
      - active_loop: null
      - action: utter_confirmar_reserva

  - rule: cancelar reserva_form
    condition:
      - active_loop: reserva_form
    steps:
      - intent: detener_formulario
      - action: action_deactivate_loop
      - active_loop: null
      - action: utter_reserva_cancelada

  - rule: confirmar reserva positiva
    steps:
      - action: utter_confirmar_reserva
      - intent: afirmar
      - action: action_crear_reserva
      - action: utter_reserva_confirmada

  - rule: confirmar reserva negativa
    steps:
      - action: utter_confirmar_reserva
      - intent: negar
      - action: utter_reserva_cancelada

  - rule: rutina_form activa
    condition:
      - active_loop: rutina_form
    steps:
      - action: rutina_form
      - active_loop: rutina_form
      - action: action_listen

  - rule: completar rutina_form
    condition:
      - active_loop: rutina_form
    steps:
      - action: rutina_form
      - active_loop: null
      - action: utter_resumen_rutina
      - action: action_generar_rutina
      - slot_was_set:
          - servicio_pendiente: null

  - rule: abrir pagina de perfil
    steps:
      - intent: navegar_perfil_web
      - action: utter_link_perfil

  - rule: manejar fallback
    steps:
      - intent: nlu_fallback
      - action: utter_fuera_de_alcance
