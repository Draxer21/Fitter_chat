version: "3.1"

intents:
  - saludar
  - ayuda
  - informar
  - afirmar
  - negar
  - activar_modo_demo
  - desactivar_modo_demo
  - solicitar_rutina
  - solicitar_dieta
  - solicitar_entreno_unico
  - cambiar_objetivo_rutina
  - cambiar_musculo_rutina
  - cambiar_nivel_rutina
  - dolor_lesion
  - consultar_reserva
  - crear_reserva
  - enviar_rutina_correo
  - mostrar_rutina_pantalla
  - suscripcion_alta
  - suscripcion_baja
  - suscripcion_cambio_plan
  - consultar_perfil
  - actualizar_perfil
  - actualizar_perfil_bot
  - navegar_perfil_web
  - soporte_general
  - soporte_mfa
  - detener_formulario
  - faq
  - nlu_fallback

entities:
  - objetivo
  - musculo
  - hero_programa
  - nivel
  - equipamiento
  - ejercicios_num
  - tiempo_disponible
  - condiciones_salud
  - alergias
  - no_gusta
  - alimentos_no_gustan
  - formato
  - contacto
  - email
  - codigo_reserva
  - clase
  - fecha
  - hora

slots:
  objetivo:
    type: text
    mappings:
      - type: from_entity
        entity: objetivo
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: objetivo

  musculo:
    type: text
    mappings:
      - type: from_entity
        entity: musculo
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: musculo

  nivel:
    type: text
    mappings:
      - type: from_entity
        entity: nivel
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: nivel

  equipamiento:
    type: text
    mappings:
      - type: from_entity
        entity: equipamiento
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: equipamiento

  ejercicios_num:
    type: text
    mappings:
      - type: from_entity
        entity: ejercicios_num
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: ejercicios_num

  tiempo_disponible:
    type: text
    mappings:
      - type: from_entity
        entity: tiempo_disponible
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: tiempo_disponible

  condiciones_salud:
    type: text
    mappings:
      - type: from_entity
        entity: condiciones_salud
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: condiciones_salud

  alergias:
    type: text
    mappings:
      - type: from_entity
        entity: alergias
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: alergias

  no_gusta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: no_gusta
      - type: from_entity
        entity: alimentos_no_gustan

  formato:
    type: text
    mappings:
      - type: from_entity
        entity: formato
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: formato

  contacto:
    type: text
    mappings:
      - type: from_entity
        entity: contacto
      - type: from_entity
        entity: email

  email:
    type: text
    mappings:
      - type: from_entity
        entity: email

  clase:
    type: text
    mappings:
      - type: from_entity
        entity: clase
      - type: from_text
        conditions:
          - active_loop: reserva_form
            requested_slot: clase

  fecha:
    type: text
    mappings:
      - type: from_entity
        entity: fecha
      - type: from_text
        conditions:
          - active_loop: reserva_form
            requested_slot: fecha

  hora:
    type: text
    mappings:
      - type: from_entity
        entity: hora
      - type: from_text
        conditions:
          - active_loop: reserva_form
            requested_slot: hora

  codigo_reserva:
    type: text
    mappings:
      - type: from_entity
        entity: codigo_reserva

  hero_programa:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: hero_form
            requested_slot: hero_programa
      - type: from_entity
        entity: hero_programa

  hero_inicio:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: hero_form
            requested_slot: hero_inicio

  hero_equipo:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: hero_form
            requested_slot: hero_equipo

  peso:
    type: float
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: peso

  altura:
    type: float
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: altura

  objetivo_fitness:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: objetivo_fitness

  somatotipo:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: somatotipo

  demo_offline:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: from_intent
        intent: activar_modo_demo
        value: true
      - type: from_intent
        intent: desactivar_modo_demo
        value: false

  offline_mode:
    type: bool
    influence_conversation: false
    mappings:
      - type: custom

  offline_notified:
    type: bool
    influence_conversation: false
    initial_value: false
    mappings:
      - type: custom

  backend_down:
    type: bool
    influence_conversation: true
    initial_value: false
    mappings:
      - type: custom

  padecimientos:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: padecimientos

  preferencia_dieta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: preferencia_dieta
  musculo_preferido:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: musculo_preferido

  resumen_perfil:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  perfil_completo:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom

  requested_plan:
    type: categorical
    values:
      - rutina
      - dieta
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: solicitar_rutina
        value: rutina
        conditions:
          - active_loop: null
      - type: from_intent
        intent: solicitar_dieta
        value: dieta
        conditions:
          - active_loop: null

  servicio_pendiente:
    type: categorical
    values:
      - rutina
      - dieta
    influence_conversation: true
    mappings:
      - type: from_intent
        intent: solicitar_rutina
        value: rutina
        conditions:
          - active_loop: null
      - type: from_intent
        intent: solicitar_dieta
        value: dieta
        conditions:
          - active_loop: null

  ultima_rutina:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  ultima_dieta:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

responses:
  utter_saludar:
    - text: "¡Hola! Soy Fitter, tu compañero de entrenamiento. ¿Qué tal, amigo? ¿En qué te doy una mano hoy?"
      buttons:
        - title: "Ver mi perfil"
          payload: "/consultar_perfil"
        - title: "Generar rutina"
          payload: "/solicitar_rutina"
        - title: "Sugerir dieta"
          payload: "/solicitar_dieta"
        - title: "Soporte"
          payload: "/soporte_general"

  utter_info_servicios:
    - text: "Puedo generar rutinas, sugerir dietas, enviar planes por correo, consultar reservas y ayudarte a actualizar tu perfil. Estoy aquí para que entrenes con confianza."

  utter_dolor_lesion:
    - text: "Si notas dolor o una lesion recurrente, baja la intensidad y consulta con un profesional."

  utter_pedir_contacto:
    - text: "Genial, necesito un correo o teléfono para enviarte la rutina. ¿Me lo compartes, por fa?"

  utter_envio_rutina_correo:
    - text: "Perfecto, en unos minutos te envío la rutina a {contacto}. ¡Avísame si necesitas otro formato!"

  utter_confirmar_reserva:
    - text: "Listo, tengo la clase {clase} el {fecha} a las {hora}. ¿Confirmo la reserva?"

  utter_reserva_confirmada:
    - text: "¡Excelente! Tu cupo para {clase} el {fecha} a las {hora} quedó confirmado ✅."

  utter_reserva_cancelada:
    - text: "De acuerdo, no registré la reserva. Si quieres agendar otra, solo dime."

  utter_ask_codigo_reserva:
    - text: "Indícame el código de tu reserva y te cuento el estado, amigo."

  utter_reserva_estado:
    - text: "Estado de la reserva {codigo_reserva}: actualizado y confirmado. ¿Algo más que quieras revisar?"

  utter_faq/horarios:
    - text: "Nuestro gimnasio abre de lunes a viernes de 6:00 a 22:00, sábados de 8:00 a 20:00 y domingos de 9:00 a 14:00. Si necesitas un horario especial, avísame."

  utter_faq/pagos:
    - text: "Puedes pagar con tarjetas de crédito y débito, transferencia o Mercado Pago. También tenemos cuotas sin interés en membresías trimestrales y anuales."

  utter_suscripcion_alta:
    - text: "¡Vamos con tu suscripción! Dime qué plan prefieres y el método de pago, y lo dejamos listo."

  utter_suscripcion_baja:
    - text: "Puedo cancelar o pausar tu suscripción. Cuéntame cómo prefieres proceder y lo hago enseguida."

  utter_fuera_de_alcance:
    - text: "Lo siento, aún no puedo ayudarte con eso. ¿Te parece si lo intentamos de otra manera o me das más detalles, amigo?"

  utter_perfil_resumen:
    - text: "{resumen_perfil}"

  utter_ask_musculo:
    - text: "¿Qué grupo muscular quieres entrenar? Elige una opción:" 
      buttons:
        - title: "Pecho"
          payload: "/solicitar_rutina{\"musculo\": \"pecho\"}"
        - title: "Espalda"
          payload: "/solicitar_rutina{\"musculo\": \"espalda\"}"
        - title: "Piernas"
          payload: "/solicitar_rutina{\"musculo\": \"piernas\"}"
        - title: "Hombros"
          payload: "/solicitar_rutina{\"musculo\": \"hombros\"}"
        - title: "Brazos"
          payload: "/solicitar_rutina{\"musculo\": \"brazos\"}"
        - title: "Core"
          payload: "/solicitar_rutina{\"musculo\": \"core\"}"
        - title: "Fullbody"
          payload: "/solicitar_rutina{\"musculo\": \"fullbody\"}"
        - title: "Cardio"
          payload: "/solicitar_rutina{\"musculo\": \"cardio\"}"

  utter_ask_hero_programa:
    - text: "Tengo planes temáticos Shonen Power, Ninja Agility, Mecha Endurance, Batman (Christian Bale), Batman (Ben Affleck), Batman (Robert Pattinson), Capitan America (Chris Evans), Superman (Henry Cavill), Superman (David Corenswet) y Wolverine (Hugh Jackman). ¿Cuál te interesa?"
      buttons:
        - title: "Shonen Power"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"shonen\"}"
        - title: "Ninja Agility"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"ninja\"}"
        - title: "Mecha Endurance"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"mecha\"}"
        - title: "Batman (Christian Bale)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"batman_bale\"}"
        - title: "Batman (Ben Affleck)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"batman_affleck\"}"
        - title: "Batman (Robert Pattinson)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"batman_pattinson\"}"
        - title: "Capitan America (Chris Evans)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"capitan_america_evans\"}"
        - title: "Superman (Henry Cavill)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"superman_cavill\"}"
        - title: "Superman (David Corenswet)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"superman_corenswet\"}"
        - title: "Wolverine (Hugh Jackman)"
          payload: "/solicitar_entreno_unico{\"hero_programa\": \"wolverine_jackman\"}"

  utter_ask_hero_inicio:
    - text: "¿Cuándo quieres comenzar el plan? Puedes indicarme una fecha (ej. 2025-01-10) o decir 'la próxima semana'."

  utter_ask_hero_equipo:
    - text: "Cuéntame con qué equipamiento cuentas (casa, gimnasio, TRX, solo peso corporal). Así adapto las recomendaciones."

  utter_hero_cancelado:
    - text: "Perfecto, dejamos pendiente la selección del Entreno Único. Si quieres retomarlo, dímelo."

  utter_ask_musculo_preferido:
    - text: "¿Hay algún grupo muscular que quieras priorizar de forma habitual (pecho, espalda, piernas, hombros, brazos, core, fullbody, cardio)?"

  utter_offline_intro:
    - text: "Ahora mismo estoy en modo offline. Puedo ayudarte con una rutina/dieta básica, pero no puedo acceder a tu perfil web ni validar sesión."

  utter_offline_routine_basic:
    - text: "Rutina básica (3 días): Día 1 fullbody, Día 2 empuje/tirón, Día 3 piernas+core. ¿Objetivo: ganar músculo o bajar grasa?"

  utter_offline_diet_basic:
    - text: "Dieta básica: proteína en cada comida, verduras 2–3 porciones/día, carbos según entrenamiento. ¿Quieres enfoque hipertrofia o bajar grasa?"

  utter_demo_on:
    - text: "Modo demo activado ✅ (sin backend). Puedo darte una rutina/dieta básica."

  utter_demo_off:
    - text: "Modo demo desactivado ✅. Volvemos al flujo normal."

  utter_capabilities:
    - text: |
        Puedo ayudarte con:
        - Rutinas (con o sin perfil)
        - Dietas y calorías (si tengo peso/altura)
        - Reservas/horarios/pagos (FAQ)
        - Soporte (sesión, errores de pago, cuenta)
        Escribe “modo demo” si quieres usarlo sin backend.

  utter_perfil_incompleto:
    - text: "Para continuar necesito tus datos básicos (peso, altura, objetivo, somatotipo, padecimientos y preferencia de dieta). Dímelos uno por uno y los vamos registrando aquí mismo."

  utter_mostrar_perfil:
    - text: "Aquí tienes tu perfil: {resumen_perfil}"

  utter_link_perfil:
    - text: "Puedes actualizar tu información desde la página de perfil en https://app.fitter/perfil. Cuando termines, vuelve y dime si necesitas algo más."

  utter_perfil_actualizado:
    - text: "Perfecto, ya tengo tus datos al día. ¿Seguimos con lo que estábamos viendo o hay algo más en lo que te ayude?"

  utter_soporte_opciones:
    - text: "Dime cómo te puedo ayudar, amigo. Elige una opción y vamos al tiro:"
      buttons:
        - title: "Problemas con MFA"
          payload: "/soporte_mfa"
        - title: "Hablar con un asesor"
          payload: "/informar{\"contacto\": \"asesor\"}"

  utter_soporte_mfa:
    - text: "Si no puedes iniciar sesion con MFA, verifica la hora del dispositivo, regenera el codigo desde la app y, si es necesario, usa un codigo de respaldo o solicita uno nuevo desde tu perfil."

  utter_ask_peso:
    - text: "Cual es tu peso actual en kilogramos? Puedes aproximarlo a numeros enteros."

  utter_ask_altura:
    - text: "Cual es tu altura en centimetros?"

  utter_ask_objetivo_fitness:
    - text: "Cual es tu objetivo principal ahora mismo? (ejemplo: bajar grasa, ganar masa, rendimiento)"

  utter_ask_somatotipo:
    - text: "¿Cómo te identificas a nivel de somatotipo? (ectomorfo / mesomorfo / endomorfo / no_se)"

  utter_ask_objetivo:
    - text: "¿Cuál es tu objetivo principal? (ej. bajar_grasa, hipertrofia, equilibrada)"

  utter_ask_nivel:
    - text: "¿Cuál es tu nivel? (principiante / intermedio / avanzado)"

  utter_ask_equipamiento:
    - text: "¿Con qué equipamiento cuentas? (gimnasio / casa / mancuernas / bandas / ninguno)"

  utter_ask_ejercicios_num:
    - text: "¿Cuántos ejercicios por sesión prefieres?"

  utter_ask_tiempo_disponible:
    - text: "¿Cuánto tiempo tienes por sesión? (minutos)"

  utter_ask_condiciones_salud:
    - text: "¿Tienes lesiones o condiciones a considerar? Si no, responde \"ninguna\"."

  utter_ask_alergias:
    - text: "¿Tienes alergias o restricciones relevantes? Si no, responde \"ninguna\"."

  utter_ask_formato:
    - text: "¿Prefieres formato full-body o dividido (push/pull/legs, etc.)?"

  utter_ask_padecimientos:
    - text: "Tienes alguna condicion o padecimiento que deba considerar? Si no, dime \"ninguno\"."

  utter_ask_preferencia_dieta:
    - text: "Tienes alguna preferencia o restriccion alimentaria? (ejemplo: sin lactosa, vegetariana, ninguna)"

  utter_ask_clase:
    - text: "¿Qué clase quieres reservar (por ejemplo: yoga, spinning, funcional)?"

  utter_ask_fecha:
    - text: "¿Para qué fecha necesitas la clase? Puedes decirlo como AAAA-MM-DD."

  utter_ask_hora:
    - text: "¿A qué hora la quieres agendar?"

  utter_resumen_rutina:
    - text: "Perfecto, ya tengo tus preferencias. Te muestro un resumen antes de generar la rutina final."

  utter_form_cancelado:
    - text: "De acuerdo, no actualizare tu perfil por ahora. Si cambias de idea avisame."

forms:
  reserva_form:
    required_slots:
      - clase
      - fecha
      - hora
  profile_form:
    required_slots:
      - peso
      - altura
      - objetivo_fitness
      - somatotipo
      - padecimientos
      - preferencia_dieta
      - musculo_preferido
  hero_form:
    required_slots:
      - hero_programa
      - hero_inicio
      - hero_equipo
  rutina_form:
    required_slots:
      - objetivo
      - nivel
      - musculo
      - equipamiento
      - ejercicios_num
      - tiempo_disponible
      - condiciones_salud
      - alergias
      - formato

actions:
  - action_fetch_profile
  - action_submit_profile_form
  - action_generar_rutina
  - action_generar_dieta
  - action_consultar_reserva
  - action_inscribir_entreno_unico
  - action_crear_reserva
  - action_cancelar_reserva
  - action_suscripcion_cambio_plan
  - validate_profile_form
  - validate_reserva_form
  - validate_rutina_form
  - validate_hero_form

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
