version: "3.1"

intents:
  - actualizar_perfil
  - actualizar_perfil_bot
  - ayuda
  - cambiar_musculo_rutina
  - cambiar_nivel_rutina
  - cambiar_objetivo_rutina
  - consultar_perfil
  - consultar_reserva
  - detener_formulario
  - dolor_lesion
  - enviar_rutina_correo
  - informar
  - mostrar_rutina_pantalla
  - navegar_perfil_web
  - saludar
  - solicitar_dieta
  - solicitar_rutina
  - soporte_general
  - soporte_mfa
  - suscripcion_alta
  - suscripcion_baja
  - nlu_fallback

entities:
  - objetivo
  - musculo
  - nivel
  - clase
  - fecha
  - hora
  - dolor_zona
  - contacto
  - codigo_reserva
  - alergia
  - condicion_salud
  # RUTINA
  - equipamiento
  - ejercicios_num
  - tiempo_disponible
  - formato
  - email
  - telefono
  - plan

slots:
  objetivo:
    type: text
    mappings:
      - type: from_entity
        entity: objetivo

  musculo:
    type: text
    mappings:
      - type: from_entity
        entity: musculo

  nivel:
    type: text
    mappings:
      - type: from_entity
        entity: nivel

  clase:
    type: text
    mappings:
      - type: from_entity
        entity: clase

  fecha:
    type: text
    mappings:
      - type: from_entity
        entity: fecha

  hora:
    type: text
    mappings:
      - type: from_entity
        entity: hora

  dolor_zona:
    type: text
    mappings:
      - type: from_entity
        entity: dolor_zona

  codigo_reserva:
    type: text
    mappings:
      - type: from_entity
        entity: codigo_reserva
      - type: from_text

  contacto:
    type: text
    mappings:
      - type: from_entity
        entity: contacto
      - type: from_entity
        entity: email
      - type: from_entity
        entity: telefono
      - type: from_text

  condiciones_salud:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: condicion_salud
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: condiciones_salud

  alergias:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: alergia
      - type: from_text
        conditions:
          - active_loop: rutina_form
            requested_slot: alergias

  # RUTINA
  equipamiento:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: equipamiento

  ejercicios_num:
    type: text  # cambiado de float a text para evitar problemas con sinónimos
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: ejercicios_num
      - type: from_text

  tiempo_disponible:
    type: text  # cambiado de float a text para evitar problemas con sinónimos
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: tiempo_disponible
      - type: from_text

  # Perfil del usuario
  peso:
    type: float
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: peso

  altura:
    type: float
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: altura

  objetivo_fitness:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: objetivo_fitness

  padecimientos:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: padecimientos

  preferencia_dieta:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: profile_form
            requested_slot: preferencia_dieta

  resumen_perfil:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  perfil_completo:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom

  servicio_pendiente:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  formato:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: formato
      - type: from_text

  email:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: email
      - type: from_text

  telefono:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: telefono
      - type: from_text

  plan:
    type: text
    influence_conversation: false
    mappings:
      - type: from_entity
        entity: plan
      - type: from_text

  ultima_rutina:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  ultima_dieta:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  # SLOT CLAVE PARA DECISIÓN POST-GENERACIÓN
  formato_entrega:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: formato
      - type: from_intent
        intent: mostrar_rutina_pantalla
        value: "pantalla"
      - type: from_intent
        intent: enviar_rutina_correo
        value: "correo"

  # Opcional si muestras el estado textual de la consulta
  estado_reserva:
    type: text
    influence_conversation: false
    mappings:
      - type: from_text

forms:
  rutina_form:
    required_slots:
      - musculo
      - nivel
      - objetivo
      - equipamiento
      - ejercicios_num
      - tiempo_disponible
      - condiciones_salud
      - alergias
      - formato

  profile_form:
    required_slots:
      - peso
      - altura
      - objetivo_fitness
      - padecimientos
      - preferencia_dieta

  reserva_form:
    required_slots:
      - clase
      - fecha
      - hora

responses:
  # BÁSICOS
  utter_saludar:
    - text: "¡Hola! Soy FITTER. ¿En qué puedo ayudarte?"

  utter_despedir:
    - text: "¡Hasta luego! Recuerda mantenerte hidratado."

  utter_agradecimiento:
    - text: "¡Con gusto! ¿Hay algo más en lo que pueda ayudarte?"

  utter_info_servicios:
    - text: "Puedo sugerirte rutinas, reservar clases, informar precios, horarios y mucho más."

  utter_horarios:
    - text: "Lunes a viernes: 06:00–22:00 · Sábado: 08:00–20:00."

  utter_precios_planes:
    - text: "Contamos con planes Mensual, Trimestral y Anual. ¿Deseas que te comparta el detalle por WhatsApp o correo?"

  utter_privacidad:
    - text: "Tus datos son gestionados conforme a nuestra política de privacidad."

  utter_ubicacion:
    - text: "Estamos ubicados en Av. Principal 123, piso 2."

  utter_consejo_nutricion:
    - text: "Para un mejor rendimiento, prioriza alimentos reales y una adecuada ingesta de proteínas. ¿Quieres que te entregue una pauta personalizada?"

  utter_dolor_lesion:
    - text: "Si sientes un dolor agudo o inusual, detén el ejercicio y consulta a un profesional."

  utter_perfil_resumen:
    - text: "{resumen_perfil}"

  utter_perfil_incompleto:
    - text: "Para continuar necesito datos básicos de tu perfil. ¿Prefieres actualizarlos aquí conmigo o desde la página?"

  utter_perfil_actualizado:
    - text: "Perfil actualizado. ¿Quieres que genere tu rutina o dieta con esta información?"

  utter_form_cancelado:
    - text: "Formulario cancelado. Si quieres continuar más tarde, solo avísame."

  # PROMPTS DEL FORM RUTINA
  utter_ask_musculo:
    - text: "¿Qué grupo muscular deseas trabajar? (pecho, espalda, piernas, hombros, brazos, core, fullbody, cardio)"

  utter_ask_nivel:
    - text: "¿Cuál es tu nivel de entrenamiento? (principiante, intermedio, avanzado)"

  utter_ask_objetivo:
    - text: "¿Cuál es tu objetivo? (hipertrofia, fuerza, pérdida de grasa, resistencia)"

  utter_ask_equipamiento:
    - text: "¿Con qué equipamiento cuentas? (barra, mancuernas, poleas, máquinas, peso corporal)"

  utter_ask_ejercicios_num:
    - text: "¿Cuántos ejercicios deseas por sesión? (recomendado: 6–8)"

  utter_ask_tiempo_disponible:
    - text: "¿Cuánto tiempo tienes disponible por sesión en minutos? (30 / 45 / 60)"

  utter_ask_condiciones_salud:
    - text: "Tienes alguna condicion medica que debamos considerar? (hipertension, asma, lesiones). Si no aplica responde \"ninguna\"."

  utter_ask_alergias:
    - text: "Presentas alergias o intolerancias alimentarias? Dime cuales o responde \"ninguna\"."

  utter_ask_formato:
    - text: "¿Cómo prefieres recibir la rutina? (pantalla / correo / WhatsApp)"

  # PROMPTS DEL FORM PERFIL
  utter_ask_peso:
    - text: "¿Cuál es tu peso actual en kg?"

  utter_ask_altura:
    - text: "¿Cuál es tu altura en cm?"

  utter_ask_objetivo_fitness:
    - text: "¿Cuál es tu objetivo principal de fitness? (ej: ganar masa, perder grasa, mejorar resistencia)"

  utter_ask_padecimientos:
    - text: "¿Tienes algún padecimiento o condición de salud relevante? Si no aplica, responde \"ninguno\"."

  utter_ask_preferencia_dieta:
    - text: "¿Tienes alguna preferencia o restricción dietaria? (vegetariana, sin lactosa, sin gluten, ninguna)"

  # RESÚMENES / ENTREGA DE RUTINA
  utter_resumen_rutina:
    - text: |
        Resumen ▶ {musculo} · {nivel} · Objetivo: {objetivo}
        Ejercicios: {ejercicios_num} · Tiempo: {tiempo_disponible} min · Equipo: {equipamiento}
        Generando plan con técnica y video…

  utter_pedir_contacto:
    - text: "¿Cuál es tu correo electrónico o número de teléfono para enviarte la rutina?"

  utter_envio_rutina_correo:
    - text: "Perfecto, enviaré la rutina a {contacto} (modo demostración)."

  # BINARIOS / ESTADO
  utter_affirm:
    - text: "Perfecto."

  utter_deny:
    - text: "Entendido, no se realizará."

  utter_progreso_registrado:
    - text: "Tu progreso ha sido registrado exitosamente."

  utter_fuera_de_alcance:
    - text: "Lo siento, por ahora no puedo ayudarte con esa solicitud. ¿Deseas reformularla?"

  utter_contacto_humano:
    - text: "De acuerdo, derivaré tu caso a un agente humano. Por favor, déjame un medio de contacto."

  # PLANES
  utter_suscripcion_alta:
    - text: "Para activar tu suscripción, confirma el plan y el método de pago."

  utter_suscripcion_baja:
    - text: "Puedo gestionar tu baja o pausar tu suscripción. ¿Cómo deseas proceder?"

  utter_suscripcion_cambio_plan:
    - text: "¿A qué plan deseas cambiarte? (Mensual, Trimestral, Anual)"

  utter_soporte_opciones:
    - text: "Puedo ayudarte con recuperación de cuenta, MFA y problemas de acceso. ¿Qué necesitas?"

  utter_soporte_mfa:
    - text: "Para MFA, verifica tu app de autenticación o solicita un código de respaldo. ¿Quieres regenerar códigos?"

  utter_link_perfil:
    - text: "Abre tu perfil en la web: https://fitter.com/perfil"

  # RESERVAS
  utter_confirmar_reserva:
    - text: "Por favor confirma: {clase} el {fecha} a las {hora}. ¿Procedo a crear la reserva?"

  utter_reserva_confirmada:
    - text: "Reserva confirmada ✅ {clase} el {fecha} a las {hora}. Código: {codigo_reserva}"

  utter_reserva_cancelada:
    - text: "Entendido. No crearé o cancelaré la reserva según tu solicitud."

  utter_ask_codigo_reserva:
    - text: "Indícame tu código de reserva para continuar."

  utter_reserva_estado:
    - text: "Estado de tu reserva {codigo_reserva}: {estado_reserva}"

actions:
  - action_consejo_nutricion
  - action_sugerir_rutina
  - action_resumen_rutina
  - action_crear_reserva
  - action_cancelar_reserva
  - action_consultar_reserva
  - action_suscripcion_cambio_plan
  - action_generar_rutina
  - action_generar_dieta
  - action_fetch_profile
  - action_submit_profile_form

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
