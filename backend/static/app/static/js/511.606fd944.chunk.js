"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[511],{326:(e,a,s)=>{s.d(a,{A:()=>r});const n=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}),r=e=>{if(null===e||void 0===e)return n.format(0);const a="number"===typeof e?e:Number.parseFloat(e);if(!Number.isFinite(a))return n.format(0);const s=Math.round(a);return n.format(s)}},511:(e,a,s)=>{s.r(a),s.d(a,{default:()=>p});var n=s(555),r=s(43),t=s(352),c=s(462),l=s(326),i=s(640),m=s(579);function d(e){let{number:a,name:s,exp:n,cvv:r,focus:t,brand:c}=e;const l="cvv"===t,i=(a||"").split(" ").filter(Boolean),d=r||"***";return(0,m.jsx)("div",{className:"payment-card-preview","aria-hidden":"true",children:(0,m.jsxs)("div",{className:"payment-card-visual ".concat(l?"payment-card-visual--flipped":""),children:[(0,m.jsxs)("div",{className:"payment-card-face payment-card-face--front",children:[(0,m.jsxs)("div",{className:"payment-card-top",children:[(0,m.jsx)("span",{className:"payment-card-brand",children:c}),(0,m.jsx)("span",{className:"payment-card-chip"})]}),(0,m.jsx)("div",{className:"payment-card-number",children:i.length>0?i.map((e,a)=>(0,m.jsx)("span",{className:"payment-card-number-group",children:e},a)):"**** **** **** ****"}),(0,m.jsxs)("div",{className:"payment-card-footer",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"payment-card-label",children:"Titular"}),(0,m.jsx)("span",{className:"payment-card-value",children:s})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"payment-card-label",children:"Expira"}),(0,m.jsx)("span",{className:"payment-card-value",children:n})]})]})]}),(0,m.jsxs)("div",{className:"payment-card-face payment-card-face--back",children:[(0,m.jsx)("div",{className:"payment-card-stripe"}),(0,m.jsxs)("div",{className:"payment-card-cvv-row",children:[(0,m.jsx)("span",{className:"payment-card-label",children:"CVV"}),(0,m.jsx)("span",{className:"payment-card-cvv",children:d})]}),(0,m.jsx)("div",{className:"payment-card-brand payment-card-brand--back",children:c})]})]})})}const o=[{label:"Carrito",status:"done"},{label:"Pago",status:"current"},{label:"Confirmacion",status:"pending"}];function p(){const[e,a]=(0,r.useState)({card_num:"",exp:"",cvv:"",name:""}),[s,p]=(0,r.useState)({}),[u,h]=(0,r.useState)(!1),[x,y]=(0,r.useState)("card_num"),v=(0,t.Zp)(),{items:j,total:N,refresh:g,status:b,error:f}=(0,i._)(),[_,M]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=!1;return M(""),g().then(()=>{e||M("")}).catch(a=>{e||M((null===a||void 0===a?void 0:a.message)||"No se pudo cargar el resumen.")}),()=>{e=!0}},[g]);const C=(0,r.useMemo)(()=>Array.isArray(j)?j:[],[j]),A="loading"===b,V=_||(null===f||void 0===f?void 0:f.message)||"",w=(0,r.useMemo)(()=>C.reduce((e,a)=>e+(Number(a.cantidad)||0),0),[C]),D=(0,r.useMemo)(()=>C.reduce((e,a)=>e+(Number(a.acumulado)||(Number(a.precio_unitario)||0)*(Number(a.cantidad)||0)),0),[C]),S=(0,r.useMemo)(()=>{const e=Number(N)||0,a=Math.max(D,e);return a<0?0:a},[N,D]),F=(0,r.useMemo)(()=>function(e){const a=e.replace(/\D/g,"");return a?/^4/.test(a)?"Visa":/^5[1-5]/.test(a)||/^2(2[2-9]|[3-7]\d)/.test(a)?"Mastercard":/^3[47]/.test(a)?"American Express":/^3(0[0-5]|[68])/.test(a)?"Diners Club":/^6(?:011|5)/.test(a)?"Discover":"Tarjeta":"Tarjeta"}(e.card_num),[e.card_num]),k=(0,r.useMemo)(()=>function(e){const a=(e.replace(/\D/g,"")+"*******************").slice(0,19).match(/.{1,4}/g);return a?a.join(" ").trim():"**** **** **** ****"}(e.card_num),[e.card_num]),E=(0,r.useMemo)(()=>function(e){const a=e.trim();return a?a.toUpperCase():"Nombre Apellido"}(e.name),[e.name]),Y=(0,r.useMemo)(()=>function(e){if(!e)return"MM/YY";const[a="",s=""]=e.split("/");return a&&s?"".concat(a.padEnd(2,"0"),"/").concat(s.padEnd(2,"0")).slice(0,5):"MM/YY"}(e.exp),[e.exp]),P=(0,r.useMemo)(()=>{if(!e.cvv)return"***";const a=e.cvv.replace(/\D/g,"");if(!a)return"***";const s=(a+"***").slice(0,4);return s.padEnd(a.length<3?3:s.length,"*")},[e.cvv]),Z=e=>{const{name:s,value:r}=e.target;let t=r;"card_num"===s?t=function(e){const a=e.replace(/\D/g,"").slice(0,19),s=a.match(/.{1,4}/g);return s?s.join(" "):a}(r):"exp"===s?t=function(e){const a=e.replace(/\D/g,"").slice(0,4);return a.length<=2?a:"".concat(a.slice(0,2),"/").concat(a.slice(2))}(r):"cvv"===s?t=r.replace(/\D/g,"").slice(0,4):"name"===s&&(t=function(e){return e.replace(/\s{2,}/g," ")}(r)),a(e=>(0,n.A)((0,n.A)({},e),{},{[s]:t}))},I=e=>{y(e)},H=()=>{const a={},s=e.card_num.replace(/\s/g,"");if(s&&/^\d{13,19}$/.test(s)&&function(e){let a=0,s=!1;for(let n=e.length-1;n>=0;n--){const r=e.charAt(n);if(!/^\d$/.test(r))return!1;let t=parseInt(r,10);s&&(t*=2,t>9&&(t-=9)),a+=t,s=!s}return a%10===0}(s)||(a.card_num="Numero de tarjeta invalido."),e.exp&&/^\d{2}\/\d{2}$/.test(e.exp)){const[s,n]=e.exp.split("/"),r=Number(s),t=Number(n);if(!Number.isInteger(r)||r<1||r>12)a.exp="Mes invalido.";else{const e=new Date(2e3+t,r-1,1),s=new Date;e<new Date(s.getFullYear(),s.getMonth(),1)&&(a.exp="Tarjeta expirada.")}}else a.exp="Fecha de expiracion invalida (MM/YY).";return e.cvv&&/^\d{3,4}$/.test(e.cvv)||(a.cvv="CVV invalido."),e.name.trim()?e.name.trim().length<3&&(a.name="Ingresa el nombre completo."):a.name="Nombre del titular requerido.",p(a),0===Object.keys(a).length},T=!A&&!V&&0===C.length;return(0,m.jsx)("div",{className:"payment-page",children:(0,m.jsx)("div",{className:"payment-shell",children:(0,m.jsxs)("div",{className:"payment-card",children:[(0,m.jsxs)("header",{className:"payment-header",children:[(0,m.jsxs)("div",{className:"payment-branding",children:[(0,m.jsx)("div",{className:"payment-brand",children:"Fitter Pay"}),(0,m.jsxs)("div",{className:"payment-security",children:[(0,m.jsx)("svg",{className:"payment-lock-icon",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,m.jsx)("path",{fill:"currentColor",d:"M5.5 8V6a4.5 4.5 0 0 1 9 0v2h.75A1.75 1.75 0 0 1 17 9.75v6.5A1.75 1.75 0 0 1 15.25 18H4.75A1.75 1.75 0 0 1 3 16.25v-6.5A1.75 1.75 0 0 1 4.75 8H5.5Zm2-2a2.5 2.5 0 1 1 5 0v2h-5V6Zm3.25 6.448a1.25 1.25 0 1 0-1.5 0V14.5h1.5v-2.052Z"})}),(0,m.jsx)("span",{children:"Pago cifrado SSL"})]})]}),(0,m.jsx)("div",{className:"payment-steps",children:o.map(e=>(0,m.jsxs)("span",{className:"payment-step payment-step--".concat(e.status),children:[(0,m.jsx)("span",{className:"payment-step-dot"}),e.label]},e.label))})]}),(0,m.jsxs)("div",{className:"payment-content",children:[(0,m.jsxs)("section",{className:"payment-main",children:[(0,m.jsxs)("div",{className:"payment-main-headline",children:[(0,m.jsx)("h1",{children:"Completa tu pago"}),(0,m.jsx)("p",{children:"Verifica los datos y finaliza la compra con una experiencia segura inspirada en los portales bancarios."})]}),(0,m.jsxs)("div",{className:"payment-main-visuals",children:[(0,m.jsx)(d,{number:k,name:E,exp:Y,cvv:P,focus:x,brand:F}),(0,m.jsxs)("div",{className:"payment-card-logos","aria-hidden":"true",children:[(0,m.jsx)("span",{className:"payment-logo payment-logo--visa",children:"VISA"}),(0,m.jsx)("span",{className:"payment-logo payment-logo--mastercard",children:"Mastercard"}),(0,m.jsx)("span",{className:"payment-logo payment-logo--amex",children:"Amex"}),(0,m.jsx)("span",{className:"payment-logo payment-logo--diners",children:"Diners"})]})]}),(0,m.jsxs)("form",{className:"payment-form",onSubmit:async a=>{if(a.preventDefault(),H()){h(!0);try{const a=await c.n.carrito.pagar((0,n.A)((0,n.A)({},e),{},{card_num:e.card_num.replace(/\s/g,""),name:e.name.trim()}));await g().catch(()=>{});const s=null===a||void 0===a?void 0:a.order_id;v(s?"/boleta?order=".concat(s):"/boleta")}catch(r){var s;const e=(null===r||void 0===r||null===(s=r.payload)||void 0===s?void 0:s.error)||r.message||"No se pudo procesar el pago. Int\xe9ntalo nuevamente.";p({general:e})}finally{h(!1)}}},noValidate:!0,children:[(0,m.jsxs)("label",{className:"payment-field",children:[(0,m.jsx)("span",{className:"payment-label",children:"Numero de tarjeta"}),(0,m.jsx)("input",{type:"text",name:"card_num",inputMode:"numeric",autoComplete:"cc-number","aria-describedby":s.card_num?"card_num_error":void 0,value:e.card_num,onChange:Z,onFocus:()=>I("card_num"),placeholder:"1234 5678 9012 3456",className:s.card_num?"payment-input payment-input--error":"payment-input"}),(0,m.jsx)("span",{className:"payment-hint",children:"16 a 19 digitos, sin guiones."}),s.card_num&&(0,m.jsx)("span",{id:"card_num_error",className:"payment-error",role:"alert",children:s.card_num})]}),(0,m.jsxs)("div",{className:"payment-field-grid",children:[(0,m.jsxs)("label",{className:"payment-field",children:[(0,m.jsx)("span",{className:"payment-label",children:"Expiracion (MM/YY)"}),(0,m.jsx)("input",{type:"text",name:"exp",inputMode:"numeric",autoComplete:"cc-exp","aria-describedby":s.exp?"exp_error":void 0,value:e.exp,onChange:Z,onFocus:()=>I("exp"),placeholder:"12/28",className:s.exp?"payment-input payment-input--error":"payment-input"}),s.exp&&(0,m.jsx)("span",{id:"exp_error",className:"payment-error",role:"alert",children:s.exp})]}),(0,m.jsxs)("label",{className:"payment-field",children:[(0,m.jsx)("span",{className:"payment-label",children:"CVV"}),(0,m.jsx)("input",{type:"text",name:"cvv",inputMode:"numeric",autoComplete:"cc-csc","aria-describedby":s.cvv?"cvv_error":void 0,value:e.cvv,onChange:Z,onFocus:()=>I("cvv"),placeholder:"123",className:s.cvv?"payment-input payment-input--error":"payment-input"}),(0,m.jsx)("span",{className:"payment-hint",children:"3 o 4 digitos segun la tarjeta."}),s.cvv&&(0,m.jsx)("span",{id:"cvv_error",className:"payment-error",role:"alert",children:s.cvv})]})]}),(0,m.jsxs)("label",{className:"payment-field",children:[(0,m.jsx)("span",{className:"payment-label",children:"Nombre del titular"}),(0,m.jsx)("input",{type:"text",name:"name",autoComplete:"cc-name","aria-describedby":s.name?"name_error":void 0,value:e.name,onChange:Z,onFocus:()=>I("name"),placeholder:"Nombre Apellido",className:s.name?"payment-input payment-input--error":"payment-input"}),s.name&&(0,m.jsx)("span",{id:"name_error",className:"payment-error",role:"alert",children:s.name})]}),s.general&&(0,m.jsx)("div",{className:"payment-alert",role:"alert","aria-live":"assertive",children:s.general}),(0,m.jsx)("button",{type:"submit",className:"payment-submit",disabled:u,children:u?"Procesando pago...":"Pagar ".concat((0,l.A)(S))}),(0,m.jsx)("div",{className:"payment-terms",children:(0,m.jsxs)("p",{children:["Al continuar aceptas nuestros terminos y condiciones. Este cargo puede aparecer en tu estado de cuenta como",(0,m.jsx)("strong",{children:" Fitter"}),"."]})})]}),(0,m.jsxs)("div",{className:"payment-trust",children:[(0,m.jsxs)("div",{className:"payment-trust-item",children:[(0,m.jsx)("svg",{className:"payment-lock-icon",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,m.jsx)("path",{fill:"currentColor",d:"M5.5 8V6a4.5 4.5 0 0 1 9 0v2h.75A1.75 1.75 0 0 1 17 9.75v6.5A1.75 1.75 0 0 1 15.25 18H4.75A1.75 1.75 0 0 1 3 16.25v-6.5A1.75 1.75 0 0 1 4.75 8H5.5Zm2-2a2.5 2.5 0 1 1 5 0v2h-5V6Zm3.25 6.448a1.25 1.25 0 1 0-1.5 0V14.5h1.5v-2.052Z"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{children:"Compra protegida"}),(0,m.jsx)("p",{children:"Aplicamos protocolos PCI-DSS y verificacion de identidad para proteger tus pagos."})]})]}),(0,m.jsxs)("div",{className:"payment-trust-item",children:[(0,m.jsx)("svg",{className:"payment-lock-icon",viewBox:"0 0 20 20","aria-hidden":"true",children:(0,m.jsx)("path",{fill:"currentColor",d:"M10 3.5 4 9.5h1.5V15h3v-3h3v3h3V9.5H16L10 3.5Z"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{children:"Entrega garantizada"}),(0,m.jsx)("p",{children:"Si algo falla, nuestro equipo estara disponible 24/7 para ayudarte con tu pedido."})]})]})]})]}),(0,m.jsxs)("aside",{className:"payment-sidebar",children:[(0,m.jsxs)("div",{className:"payment-summary",children:[(0,m.jsxs)("div",{className:"payment-summary-header",children:[(0,m.jsx)("h2",{children:"Resumen del pedido"}),(0,m.jsx)("p",{children:w>0?"".concat(w," articulo").concat(w>1?"s":""):"Sin articulos en el carrito"})]}),A&&(0,m.jsx)("div",{className:"payment-summary-state",role:"status","aria-live":"polite",children:"Cargando resumen..."}),V&&(0,m.jsx)("div",{className:"payment-summary-state payment-summary-state--error",role:"alert","aria-live":"assertive",children:V}),T&&(0,m.jsxs)("div",{className:"payment-summary-state",role:"status","aria-live":"polite",children:[(0,m.jsx)("p",{children:"No hay productos asociados al pago."}),(0,m.jsx)("button",{type:"button",className:"payment-secondary-btn",onClick:()=>v("/carrito"),children:"Volver al carrito"})]}),!A&&!V&&C.length>0&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("ul",{className:"payment-summary-items",children:C.slice(0,3).map(e=>(0,m.jsxs)("li",{className:"payment-summary-item",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("span",{className:"payment-summary-name",children:e.nombre||"Producto"}),(0,m.jsxs)("span",{className:"payment-summary-meta",children:["x",e.cantidad||1]})]}),(0,m.jsx)("span",{className:"payment-summary-price",children:(0,l.A)(Number(e.acumulado)||Number(e.precio_unitario)||0)})]},e.producto_id||e.id))}),C.length>3&&(0,m.jsxs)("div",{className:"payment-summary-more",children:["+ ",C.length-3," articulo",C.length-3>1?"s":""," mas"]}),(0,m.jsxs)("div",{className:"payment-summary-breakdown",children:[(0,m.jsxs)("div",{className:"payment-summary-row",children:[(0,m.jsx)("span",{children:"Subtotal"}),(0,m.jsx)("span",{children:(0,l.A)(D)})]}),(0,m.jsxs)("div",{className:"payment-summary-row",children:[(0,m.jsx)("span",{children:"Envio"}),(0,m.jsx)("span",{children:"Sin costo"})]}),(0,m.jsxs)("div",{className:"payment-summary-row payment-summary-row--total",children:[(0,m.jsx)("span",{children:"Total a pagar"}),(0,m.jsx)("span",{children:(0,l.A)(S)})]})]})]})]}),(0,m.jsxs)("div",{className:"payment-help",children:[(0,m.jsx)("h3",{children:"Necesitas ayuda?"}),(0,m.jsx)("p",{children:"Escribenos a soporte@fitter.com o llama al +56 9 1234 5678 para asistencia inmediata."}),(0,m.jsx)("button",{type:"button",className:"payment-secondary-btn",onClick:()=>v("/carrito"),children:"Revisar carrito"})]})]})]})]})})})}}}]);
//# sourceMappingURL=511.606fd944.chunk.js.map