"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[191],{191:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(555),l=a(43),n=a(462),r=a(528),c=a(326),d=a(579);const i=e=>{try{return new Date(e).toLocaleDateString()}catch(s){return e}};function o(e){let{label:s,value:a}=e;return(0,d.jsxs)("div",{className:"sales-card",children:[(0,d.jsx)("span",{className:"sales-card__label",children:s}),(0,d.jsx)("strong",{className:"sales-card__value",children:a})]})}function h(e){let{data:s}=e;if(!s||0===s.length)return(0,d.jsx)("p",{className:"text-muted",children:"Sin datos para el rango seleccionado."});const a=Math.max(...s.map(e=>e.total||0));return(0,d.jsx)("div",{className:"sales-chart",children:s.map(e=>(0,d.jsxs)("div",{className:"sales-chart__item",children:[(0,d.jsx)("div",{className:"sales-chart__bar",style:{height:a?"".concat(Math.max(e.total/a*100,6),"%"):"6%"}}),(0,d.jsx)("span",{className:"sales-chart__label",children:i(e.date)}),(0,d.jsx)("span",{className:"sales-chart__value",children:(0,c.A)(e.total)})]},e.date))})}function m(){const{isAdmin:e}=(0,r.A)(),[s,a]=(0,l.useState)(null),[m,u]=(0,l.useState)([]),[x,j]=(0,l.useState)({status:"",start:"",end:""}),[p,v]=(0,l.useState)(!0),[b,N]=(0,l.useState)(""),f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(!0);try{const s=new URLSearchParams((0,t.A)({},e)),l=await n.n.orders.summary(s.toString()),r=await n.n.orders.list(s.toString());a(l),u((null===r||void 0===r?void 0:r.orders)||[]),N("")}catch(s){N((null===s||void 0===s?void 0:s.message)||"No pudimos cargar los datos de ventas.")}finally{v(!1)}};(0,l.useEffect)(()=>{e&&f()},[e]);const g=e=>{const{name:s,value:a}=e.target;j(e=>(0,t.A)((0,t.A)({},e),{},{[s]:a}))};return e?(0,d.jsxs)("main",{className:"container py-4 admin-sales",children:[(0,d.jsx)("h1",{className:"mb-4",children:"Panel de ventas"}),(0,d.jsxs)("form",{className:"sales-filters",onSubmit:e=>{e.preventDefault();const s={};x.status&&(s.status=x.status),x.start&&(s.start=x.start),x.end&&(s.end=x.end),f(s)},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"form-label",children:"Estado"}),(0,d.jsxs)("select",{name:"status",className:"form-select",value:x.status,onChange:g,children:[(0,d.jsx)("option",{value:"",children:"Todos"}),(0,d.jsx)("option",{value:"paid",children:"Pagados"}),(0,d.jsx)("option",{value:"refunded",children:"Reembolsados"}),(0,d.jsx)("option",{value:"cancelled",children:"Cancelados"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"form-label",children:"Desde"}),(0,d.jsx)("input",{type:"date",name:"start",className:"form-control",value:x.start,onChange:g})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{className:"form-label",children:"Hasta"}),(0,d.jsx)("input",{type:"date",name:"end",className:"form-control",value:x.end,onChange:g})]}),(0,d.jsx)("button",{type:"submit",className:"btn btn-dark align-self-end",children:"Aplicar"})]}),p&&(0,d.jsx)("div",{className:"alert alert-info",children:"Cargando informacion..."}),b&&(0,d.jsx)("div",{className:"alert alert-danger",children:b}),s&&!p&&!b&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("section",{className:"sales-summary",children:[(0,d.jsx)(o,{label:"Ventas totales",value:(0,c.A)(s.total_sales)}),(0,d.jsx)(o,{label:"Ordenes",value:s.total_orders}),(0,d.jsx)(o,{label:"Ordenes pagadas",value:s.paid_orders}),(0,d.jsx)(o,{label:"Ventas ultimos 30 dias",value:(0,c.A)(s.sales_last_30)})]}),(0,d.jsxs)("section",{className:"sales-chart-section",children:[(0,d.jsx)("h2",{children:"Ventas diarias (30 dias)"}),(0,d.jsx)(h,{data:s.daily_sales})]}),(0,d.jsxs)("section",{className:"sales-top-products",children:[(0,d.jsx)("h2",{children:"Productos destacados"}),(0,d.jsx)("ul",{children:s.top_products.map(e=>(0,d.jsxs)("li",{children:[(0,d.jsx)("strong",{children:e.name})," - ",e.quantity," uds - ",(0,c.A)(e.revenue)]},e.name))})]})]}),(0,d.jsxs)("section",{className:"sales-table-section",children:[(0,d.jsx)("h2",{children:"Ordenes recientes"}),(0,d.jsx)("div",{className:"table-responsive",children:(0,d.jsxs)("table",{className:"table table-striped align-middle",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"ID"}),(0,d.jsx)("th",{children:"Fecha"}),(0,d.jsx)("th",{children:"Cliente"}),(0,d.jsx)("th",{children:"Total"}),(0,d.jsx)("th",{children:"Estado"})]})}),(0,d.jsxs)("tbody",{children:[m.map(e=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:e.id}),(0,d.jsx)("td",{children:i(e.created_at)}),(0,d.jsx)("td",{children:e.customer_name||"Invitado"}),(0,d.jsx)("td",{children:(0,c.A)(e.total_amount)}),(0,d.jsx)("td",{children:(0,d.jsx)("span",{className:"badge bg-".concat("paid"===e.status?"success":"secondary"),children:e.status})})]},e.id)),!m.length&&!p&&(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:5,className:"text-center text-muted py-4",children:"Sin ordenes para los filtros seleccionados."})})]})]})})]})]}):(0,d.jsx)("div",{className:"container py-5",children:"No autorizado."})}},326:(e,s,a)=>{a.d(s,{A:()=>l});const t=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}),l=e=>{if(null===e||void 0===e)return t.format(0);const s="number"===typeof e?e:Number.parseFloat(e);if(!Number.isFinite(s))return t.format(0);const a=Math.round(s);return t.format(a)}}}]);
//# sourceMappingURL=191.0df8367f.chunk.js.map