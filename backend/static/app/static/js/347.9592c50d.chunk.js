"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[347],{347:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});var c=s(43),i=s(352),l=s(528),t=s(579);const d=e=>{if(!e)return"\u2014";try{const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString()}catch(a){return e}};function r(){var e;const{isAuthenticated:a,mfa:s,loadMfaStatus:r,startMfaSetup:n,confirmMfa:o,disableMfa:u}=(0,l.A)(),[m,h]=(0,c.useState)(""),[v,p]=(0,c.useState)(""),[x,g]=(0,c.useState)(""),[j,N]=(0,c.useState)(""),[b,f]=(0,c.useState)(""),[y,A]=(0,c.useState)([]),C=Boolean(null===s||void 0===s?void 0:s.enabled),w=null!==(e=null===s||void 0===s?void 0:s.backupCodesLeft)&&void 0!==e?e:0;(0,c.useEffect)(()=>{a?r().catch(()=>{}):A([])},[a,r]),(0,c.useEffect)(()=>{Array.isArray(null===s||void 0===s?void 0:s.recoveryCodes)&&A(s.recoveryCodes)},[null===s||void 0===s?void 0:s.recoveryCodes]);const M=(0,c.useMemo)(()=>Boolean((null===s||void 0===s?void 0:s.secret)||(null===s||void 0===s?void 0:s.otpauthUrl)),[null===s||void 0===s?void 0:s.secret,null===s||void 0===s?void 0:s.otpauthUrl]);return a?(0,t.jsx)("main",{className:"account-security-page py-5",children:(0,t.jsx)("div",{className:"container account-security-shell",children:(0,t.jsx)("div",{className:"row justify-content-center",children:(0,t.jsxs)("div",{className:"col-xl-8 col-lg-9",children:[(0,t.jsxs)("section",{className:"security-hero mb-4",children:[(0,t.jsx)("span",{className:"security-hero__badge",children:"MFA"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"mb-3",children:"Seguridad de la cuenta"}),(0,t.jsx)("p",{className:"security-hero__lead mb-0",children:"Activa la autenticaci\xf3n de dos factores (MFA) para proteger tu cuenta con un c\xf3digo adicional generado por una app (Authy, Google Authenticator, 1Password, etc.)."})]}),(0,t.jsxs)("div",{className:"security-hero__status",children:[(0,t.jsx)("span",{className:"status-pill ".concat(C?"status-pill--on":"status-pill--off"),children:C?"Protecci\xf3n activa":"Protecci\xf3n pendiente"}),(0,t.jsx)("p",{className:"status-note mb-0",children:C?"C\xf3digos de respaldo disponibles: ".concat(w):"A\xf1ade una capa extra de seguridad con MFA."})]})]}),j&&(0,t.jsx)("div",{className:"alert alert-success",children:j}),b&&(0,t.jsx)("div",{className:"alert alert-danger",children:b}),(null===s||void 0===s?void 0:s.error)&&!b&&(0,t.jsx)("div",{className:"alert alert-danger",children:s.error.message||"Error consultando MFA."}),(0,t.jsx)("section",{className:"card shadow-sm mb-4 security-card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsxs)("div",{className:"security-state",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"overline mb-1",children:"Estado actual"}),(0,t.jsxs)("div",{className:"d-flex flex-column flex-sm-row align-items-sm-center gap-2",children:[(0,t.jsx)("span",{className:"status-pill ".concat(C?"status-pill--on":"status-pill--off"),children:C?"Activado":"Desactivado"}),(0,t.jsx)("span",{className:"security-state__hint",children:C?"Tus inicios de sesi\xf3n tienen doble verificaci\xf3n.":"Activa MFA para blindar tu cuenta."})]})]}),(0,t.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:()=>{r().catch(e=>{f((null===e||void 0===e?void 0:e.message)||"No se pudo actualizar el estado MFA.")})},disabled:null===s||void 0===s?void 0:s.loading,children:null!==s&&void 0!==s&&s.loading?"Actualizando...":"Actualizar estado"})]}),(0,t.jsxs)("div",{className:"security-state__meta",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"meta-label",children:"\xdaltima activaci\xf3n"}),(0,t.jsx)("p",{className:"meta-value",children:d(null===s||void 0===s?void 0:s.enabledAt)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"meta-label",children:"C\xf3digos de respaldo"}),(0,t.jsx)("p",{className:"meta-value",children:w})]})]})]})}),!C&&(0,t.jsx)("section",{className:"card shadow-sm mb-4 security-card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"Activar MFA"}),(0,t.jsx)("p",{className:"text-muted",children:"Es necesario escanear un c\xf3digo QR o ingresar la clave secreta en tu aplicaci\xf3n autenticadora antes de confirmar."}),(0,t.jsx)("button",{type:"button",className:"btn btn-dark mb-3",onClick:async()=>{N(""),f("");try{await n(),N("Escanea el c\xf3digo QR o ingresa la clave secreta en tu app autenticadora y luego confirma con un c\xf3digo TOTP."),h("")}catch(e){f((null===e||void 0===e?void 0:e.message)||"No fue posible iniciar la configuraci\xf3n.")}},disabled:null===s||void 0===s?void 0:s.loading,children:M?"Reiniciar configuraci\xf3n":"Generar clave secreta"}),M&&(0,t.jsxs)("div",{className:"qr-setup-panel mb-3",children:[(0,t.jsx)("h6",{children:"Clave secreta"}),(0,t.jsx)("code",{style:{wordBreak:"break-all"},children:(null===s||void 0===s?void 0:s.secret)||"\u2014"}),(null===s||void 0===s?void 0:s.otpauthUrl)&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("h6",{children:"Escanea el c\xf3digo QR"}),(0,t.jsx)("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=".concat(encodeURIComponent(s.otpauthUrl)),alt:"QR para autenticar MFA",width:180,height:180}),(0,t.jsxs)("div",{className:"small text-muted mt-2",children:["Si prefieres, abre el enlace directamente:"," ",(0,t.jsx)("a",{href:s.otpauthUrl,target:"_blank",rel:"noreferrer",children:s.otpauthUrl})]})]}),(0,t.jsxs)("form",{className:"mt-3",onSubmit:async e=>{e.preventDefault(),N(""),f("");try{const e=await o(m.trim()),a=(null===e||void 0===e?void 0:e.recoveryCodes)||[];A(a),h(""),N("Autenticaci\xf3n multifactor activada. Guarda tus c\xf3digos de respaldo en un lugar seguro.")}catch(a){f((null===a||void 0===a?void 0:a.message)||"No pudimos verificar el c\xf3digo. Intenta nuevamente.")}},children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{htmlFor:"confirmTotp",className:"form-label",children:"C\xf3digo TOTP"}),(0,t.jsx)("input",{id:"confirmTotp",className:"form-control",value:m,onChange:e=>h(e.target.value),placeholder:"Introduce un c\xf3digo de 6 d\xedgitos",autoComplete:"one-time-code",required:!0})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-success",disabled:null===s||void 0===s?void 0:s.loading,children:"Confirmar activaci\xf3n"})]})]})]})}),C&&(0,t.jsx)("section",{className:"card shadow-sm mb-4 security-card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"Desactivar MFA"}),(0,t.jsx)("p",{className:"text-muted",children:"Para desactivar la autenticaci\xf3n multifactor ingresa un c\xf3digo TOTP vigente o uno de tus c\xf3digos de respaldo."}),(0,t.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),N(""),f(""),v||x)try{await u({code:v.trim(),backupCode:x.trim()}),p(""),g(""),N("Autenticaci\xf3n multifactor desactivada.")}catch(a){f((null===a||void 0===a?void 0:a.message)||"No pudimos desactivar MFA. Revisa el c\xf3digo e int\xe9ntalo de nuevo.")}else f("Ingresa un c\xf3digo TOTP o uno de respaldo para continuar.")},children:[(0,t.jsxs)("div",{className:"row g-3",children:[(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{htmlFor:"disableTotp",className:"form-label",children:"C\xf3digo TOTP"}),(0,t.jsx)("input",{id:"disableTotp",className:"form-control",value:v,onChange:e=>p(e.target.value),placeholder:"C\xf3digo de 6 d\xedgitos"})]}),(0,t.jsxs)("div",{className:"col-md-6",children:[(0,t.jsx)("label",{htmlFor:"disableBackup",className:"form-label",children:"C\xf3digo de respaldo"}),(0,t.jsx)("input",{id:"disableBackup",className:"form-control",value:x,onChange:e=>g(e.target.value),placeholder:"Ingresa un c\xf3digo de respaldo v\xe1lido"})]})]}),(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("button",{type:"submit",className:"btn btn-outline-danger",disabled:null===s||void 0===s?void 0:s.loading,children:"Desactivar MFA"})})]})]})}),Array.isArray(y)&&y.length>0&&(0,t.jsx)("section",{className:"card shadow-sm security-card",children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h5",{className:"card-title",children:"C\xf3digos de respaldo"}),(0,t.jsx)("p",{className:"text-muted",children:"Guarda estos c\xf3digos en un lugar seguro. Cada uno puede utilizarse una sola vez cuando no tengas acceso a tu app autenticadora."}),(0,t.jsx)("ol",{className:"recovery-code-list",children:y.map(e=>(0,t.jsx)("li",{children:(0,t.jsx)("code",{children:e})},e))})]})})]})})})}):(0,t.jsx)("main",{className:"account-security-page py-5",children:(0,t.jsx)("div",{className:"container account-security-shell",children:(0,t.jsx)("div",{className:"row justify-content-center",children:(0,t.jsx)("div",{className:"col-lg-6",children:(0,t.jsxs)("div",{className:"alert alert-warning shadow-lg border-0 rounded-4",children:["Necesitas iniciar sesi\xf3n para gestionar la autenticaci\xf3n de dos factores.",(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)(i.N_,{className:"btn btn-dark",to:"/login",children:"Ir al inicio de sesi\xf3n"})})]})})})})})}}}]);
//# sourceMappingURL=347.9592c50d.chunk.js.map