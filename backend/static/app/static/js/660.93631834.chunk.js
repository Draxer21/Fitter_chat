"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[660],{326:(a,e,t)=>{t.d(e,{A:()=>r});const c=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}),r=a=>{if(null===a||void 0===a)return c.format(0);const e="number"===typeof a?a:Number.parseFloat(a);if(!Number.isFinite(e))return c.format(0);const t=Math.round(e);return c.format(t)}},660:(a,e,t)=>{t.r(e),t.d(e,{default:()=>m});var c=t(43),r=t(352),s=t(462),n=t(640),l=t(326),o=t(579);const i=a=>{const e=Number(a);return Number.isFinite(e)&&e>=0?e:0},d=a=>{const e=Number(a);return Number.isFinite(e)?e:0};function m(){const a=(0,r.zy)(),{addItem:e,items:t,total:m}=(0,n._)(),[u,h]=(0,c.useState)([]),[g,x]=(0,c.useState)(!0),[p,j]=(0,c.useState)(""),[N,f]=(0,c.useState)(""),[b,v]=(0,c.useState)("all"),[_,y]=(0,c.useState)(!1),[k,C]=(0,c.useState)(""),[S,F]=(0,c.useState)("");(0,c.useEffect)(()=>{let a=!0;return x(!0),s.n.productos.list("").then(e=>{a&&(h(Array.isArray(e)?e:[]),j(""))}).catch(e=>{a&&j((null===e||void 0===e?void 0:e.message)||"No se pudieron cargar los productos.")}).finally(()=>{a&&x(!1)}),()=>{a=!1}},[]),(0,c.useEffect)(()=>{const e=new URLSearchParams(a.search),t=e.get("categoria");t&&v(t);const c=e.get("q");c&&f(c)},[a.search]);const w=(0,c.useMemo)(()=>{const a=new Set;return u.forEach(e=>{null!==e&&void 0!==e&&e.categoria&&a.add(e.categoria)}),Array.from(a).sort()},[u]),A=(0,c.useMemo)(()=>{if(!u.length)return{min:0,max:0};const a=u.map(a=>i(a.precio)).filter(a=>Number.isFinite(a));return a.length?{min:Math.min(...a),max:Math.max(...a)}:{min:0,max:0}},[u]);(0,c.useEffect)(()=>{0===A.min&&0===A.max?(C(""),F("")):(C(A.min.toString()),F(A.max.toString()))},[A.min,A.max]);const M=(0,c.useMemo)(()=>{const a=i(k),e=i(S),t=N.trim().length>0,c=N.trim().toLowerCase();return u.filter(r=>{if(!r)return!1;if("all"!==b&&r.categoria!==b)return!1;const s=i(r.precio);if(""!==k&&s<a)return!1;if(""!==S&&0!==e&&s>e)return!1;if(_&&d(r.stock)<=0)return!1;if(t){if(!"".concat(r.nombre||""," ").concat(r.descripcion||"").toLowerCase().includes(c))return!1}return!0})},[u,b,k,S,_,N]),L=t.reduce((a,e)=>a+(e.cantidad||0),0);return(0,o.jsx)("main",{className:"catalog-layout container-fluid py-4",children:(0,o.jsx)("div",{className:"row justify-content-center",children:(0,o.jsx)("div",{className:"col-12 col-xl-10",children:(0,o.jsxs)("div",{className:"catalog-grid",children:[(0,o.jsxs)("aside",{className:"catalog-filters",children:[(0,o.jsx)("h2",{children:"Filtros"}),(0,o.jsxs)("div",{className:"catalog-filter-group",children:[(0,o.jsx)("label",{htmlFor:"catalog-search",children:"Buscar"}),(0,o.jsx)("input",{id:"catalog-search",type:"text",className:"form-control",placeholder:"Nombre o descripci\xf3n",value:N,onChange:a=>f(a.target.value)})]}),(0,o.jsxs)("div",{className:"catalog-filter-group",children:[(0,o.jsx)("label",{htmlFor:"catalog-category",children:"Categor\xeda"}),(0,o.jsxs)("select",{id:"catalog-category",className:"form-select",value:b,onChange:a=>v(a.target.value),children:[(0,o.jsx)("option",{value:"all",children:"Todas"}),w.map(a=>(0,o.jsx)("option",{value:a,children:a},a))]})]}),(0,o.jsxs)("div",{className:"catalog-filter-group",children:[(0,o.jsx)("label",{className:"form-label",children:"Rango de precio"}),(0,o.jsxs)("div",{className:"d-flex gap-2",children:[(0,o.jsx)("input",{type:"number",min:"0",className:"form-control",value:k,onChange:a=>C(a.target.value),placeholder:"Desde ".concat(A.min)}),(0,o.jsx)("input",{type:"number",min:"0",className:"form-control",value:S,onChange:a=>F(a.target.value),placeholder:"Hasta ".concat(A.max)})]})]}),(0,o.jsxs)("div",{className:"form-check mt-3",children:[(0,o.jsx)("input",{className:"form-check-input",type:"checkbox",id:"catalog-stock",checked:_,onChange:a=>y(a.target.checked)}),(0,o.jsx)("label",{className:"form-check-label",htmlFor:"catalog-stock",children:"Solo productos con stock"})]})]}),(0,o.jsxs)("section",{className:"catalog-products",children:[(0,o.jsx)("header",{className:"catalog-products__header",children:(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{children:"Cat\xe1logo de productos"}),(0,o.jsx)("p",{className:"text-muted mb-0",children:g?"Cargando productos...":"".concat(M.length," de ").concat(u.length," productos")})]})}),p&&(0,o.jsx)("div",{className:"alert alert-danger",children:p}),!g&&!p&&0===M.length&&(0,o.jsx)("div",{className:"alert alert-info",children:"No encontramos productos que coincidan con tu b\xfasqueda."}),(0,o.jsx)("div",{className:"catalog-products__grid",children:M.map(a=>{const t=d(a.stock),c=t<=0,s=a.imagen_url||"/fitter_logo.png";return(0,o.jsxs)("article",{className:"catalog-card",children:[(0,o.jsxs)(r.N_,{to:"/producto/".concat(a.id),className:"catalog-card__image",children:[(0,o.jsx)("img",{src:s,alt:a.nombre,loading:"lazy"}),a.categoria&&(0,o.jsx)("span",{className:"catalog-card__badge",children:a.categoria})]}),(0,o.jsxs)("div",{className:"catalog-card__body",children:[(0,o.jsx)("h3",{children:a.nombre}),(0,o.jsx)("p",{className:"catalog-card__description",children:a.descripcion||"Sin descripci\xf3n"}),a.rating&&(0,o.jsxs)("div",{className:"catalog-card__rating",children:[(0,o.jsxs)("span",{className:"catalog-card__stars",children:["\u2605".repeat(Math.round(a.rating)),a.rating<5?"\u2606".repeat(5-Math.round(a.rating)):""]}),(0,o.jsx)("span",{children:Number(a.rating).toFixed(1)}),a.rating_count?(0,o.jsxs)("span",{className:"text-muted",children:["(",a.rating_count,")"]}):null]}),(0,o.jsxs)("div",{className:"catalog-card__meta",children:[(0,o.jsx)("span",{children:(0,l.A)(a.precio)}),(0,o.jsx)("span",{children:t>0?"".concat(t," en stock"):"Sin stock"})]})]}),(0,o.jsxs)("div",{className:"catalog-card__actions",children:[(0,o.jsx)(r.N_,{to:"/producto/".concat(a.id),className:"btn btn-outline-secondary btn-sm catalog-card__btn",children:"Ver detalle"}),(0,o.jsx)("button",{type:"button",className:"btn btn-dark btn-sm catalog-card__btn",disabled:c,onClick:()=>(async a=>{try{await e(a)}catch(t){alert((null===t||void 0===t?void 0:t.message)||"No se pudo agregar al carrito.")}})(a.id),children:c?"Agotado":"A\xf1adir al carrito"})]})]},a.id)})})]}),(0,o.jsxs)("aside",{className:"catalog-cart",children:[(0,o.jsxs)("div",{className:"catalog-cart__header",children:[(0,o.jsx)("h2",{children:"Tu carrito"}),(0,o.jsxs)("span",{children:[L," producto",1===L?"":"s"]})]}),0===t.length?(0,o.jsx)("p",{className:"text-muted mb-0",children:"No tienes productos agregados."}):(0,o.jsx)("ul",{className:"catalog-cart__list",children:t.map(a=>{var e,t;return(0,o.jsxs)("li",{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:a.nombre||(null===(e=a.producto)||void 0===e?void 0:e.nombre)}),(0,o.jsxs)("div",{className:"text-muted small",children:[a.cantidad," x ",(0,l.A)(a.precio||(null===(t=a.producto)||void 0===t?void 0:t.precio)||0)]})]}),(0,o.jsx)("span",{children:(0,l.A)((a.precio||0)*(a.cantidad||0))})]},a.producto_id||a.id)})}),(0,o.jsxs)("div",{className:"catalog-cart__footer",children:[(0,o.jsxs)("div",{className:"catalog-cart__total",children:[(0,o.jsx)("span",{children:"Total"}),(0,o.jsx)("strong",{children:(0,l.A)(m)})]}),(0,o.jsx)(r.N_,{to:"/carrito",className:"btn btn-warning w-100",children:"Ir al carrito"})]})]})]})})})})}}}]);
//# sourceMappingURL=660.93631834.chunk.js.map