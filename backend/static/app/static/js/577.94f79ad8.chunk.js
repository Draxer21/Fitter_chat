"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[577],{326:(a,e,r)=>{r.d(e,{A:()=>s});const t=new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0,maximumFractionDigits:0}),s=a=>{if(null===a||void 0===a)return t.format(0);const e="number"===typeof a?a:Number.parseFloat(a);if(!Number.isFinite(e))return t.format(0);const r=Math.round(e);return t.format(r)}},577:(a,e,r)=>{r.r(e),r.d(e,{default:()=>l});var t=r(43),s=r(326),i=r(640),n=r(528),c=r(579);function l(){const{items:a,total:e,refresh:r,addItem:l,decrementItem:o,removeItem:d,clearCart:m,status:u,error:h}=(0,i._)(),{isAuthenticated:b,refresh:p}=(0,n.A)(),[v,N]=(0,t.useState)(!1),[x,j]=(0,t.useState)("");(0,t.useEffect)(()=>{r().catch(()=>{})},[r]);const y=async a=>{j("");try{await a()}catch(e){j((null===e||void 0===e?void 0:e.message)||"No se pudo actualizar el carrito.")}},f="loading"===u,g="updating"===u,C=(null===h||void 0===h?void 0:h.message)||"",k=x||C,w=Array.isArray(a)?a:[],A=Number(e)||0;return(0,c.jsxs)("div",{className:"cart-container",children:[(0,c.jsx)("h1",{className:"cart-title",children:"CARRITO"}),f&&(0,c.jsx)("div",{className:"loading-cart",role:"status","aria-live":"polite",children:"Cargando..."}),k&&(0,c.jsx)("div",{className:"error-cart",role:"alert","aria-live":"assertive",children:k}),!f&&!k&&0===w.length&&(0,c.jsx)("div",{className:"empty-cart",role:"status","aria-live":"polite",children:"Sin Productos"}),!f&&!k&&w.length>0&&(0,c.jsxs)(c.Fragment,{children:[w.map(a=>(0,c.jsxs)("div",{className:"cart-item",children:[(0,c.jsx)("img",{src:a.imagen||"/placeholder.jpg",alt:a.nombre,className:"cart-item-image"}),(0,c.jsxs)("div",{className:"cart-item-details",children:[(0,c.jsx)("div",{className:"cart-item-name",children:a.nombre}),(0,c.jsxs)("div",{className:"cart-item-price",children:["Precio unitario: ",(0,s.A)(a.precio_unitario)," | Total: ",(0,s.A)(a.acumulado)]}),(0,c.jsxs)("div",{className:"cart-item-controls",children:[(0,c.jsx)("button",{onClick:()=>{return e=a.producto_id,y(()=>o(e));var e},className:"quantity-btn",disabled:g,children:"-"}),(0,c.jsx)("span",{className:"quantity-display",children:a.cantidad}),(0,c.jsx)("button",{onClick:()=>{return e=a.producto_id,y(()=>l(e));var e},className:"quantity-btn",disabled:g,children:"+"}),(0,c.jsx)("button",{onClick:()=>{return e=a.producto_id,y(()=>d(e));var e},className:"remove-btn",disabled:g,children:"Eliminar"})]})]})]},a.producto_id)),(0,c.jsxs)("div",{className:"cart-summary",children:[(0,c.jsxs)("div",{className:"cart-total",children:["Total: ",(0,s.A)(A)]}),(0,c.jsxs)("div",{className:"cart-actions",children:[(0,c.jsx)("button",{onClick:()=>y(()=>m()),className:"action-btn clear-btn",disabled:g,children:"Limpiar"}),(0,c.jsx)("button",{onClick:async()=>{try{let a=b;if(!a){const e=await p().catch(()=>null);a=Boolean(null===e||void 0===e?void 0:e.auth)}if(!a)return void N(!0);j("");const e=await fetch("/carrito/pagar",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({})}),r=await e.json();if(!e.ok)return void j(r.error||"Error al procesar la compra");const t=r.sandbox_payment_url||r.payment_url;t?window.location.href=t:j("No se pudo obtener la URL de pago")}catch(a){j((null===a||void 0===a?void 0:a.message)||"Error al procesar la compra"),N(!1)}},className:"action-btn checkout-btn",disabled:g,children:"Hacer Compra"})]})]})]}),v&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"modal d-block",tabIndex:-1,role:"dialog",style:{backgroundColor:"transparent"},children:(0,c.jsx)("div",{className:"modal-dialog modal-dialog-centered",role:"document",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsxs)("div",{className:"modal-header",children:[(0,c.jsx)("h5",{className:"modal-title",children:"Necesitas iniciar sesion"}),(0,c.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>N(!1)})]}),(0,c.jsx)("div",{className:"modal-body",children:(0,c.jsx)("p",{children:"Para completar la compra debes iniciar sesion. Deseas ir al formulario de inicio de sesion ahora?"})}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>N(!1),children:"Cancelar"}),(0,c.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{window.location.href="/login?next=/carrito"},children:"Ir a Login"})]})]})})}),(0,c.jsx)("div",{className:"modal-backdrop fade show",style:{opacity:.5}})]})]})}}}]);
//# sourceMappingURL=577.94f79ad8.chunk.js.map