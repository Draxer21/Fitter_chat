{"version":3,"file":"static/js/152.24e151c7.chunk.js","mappings":"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","sources":["pages/TablaProductos.jsx","utils/formatPrice.js"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { API } from \"../services/apijs\";\r\nimport \"../styles/legacy/tabla_productos/style_tabla_productos.css\";\r\nimport { formatearPrecio } from \"../utils/formatPrice\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\n\r\nconst stockDisponible = (valor) => {\r\n  const stock = Number(valor);\r\n  return Number.isFinite(stock) ? stock : 0;\r\n};\r\n\r\nexport default function TablaProductos() {\r\n  const [items, setItems] = useState([]);\r\n  const [err, setErr] = useState(\"\");\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const nav = useNavigate();\r\n  const { isAdmin, initialized, refresh } = useAuth();\r\n\r\n  const load = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await API.productos.list();\r\n      setItems(data);\r\n      setErr(\"\");\r\n    } catch (e) {\r\n      setErr(e.message || \"No se pudo cargar el inventario.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!initialized) {\r\n      refresh().catch(() => {});\r\n      return;\r\n    }\r\n    if (!isAdmin) {\r\n      nav(\"/login\");\r\n      return;\r\n    }\r\n    load();\r\n  }, [initialized, isAdmin, load, nav, refresh]);\r\n\r\n  const del = useCallback(\r\n    async (id) => {\r\n      if (!window.confirm(\"Eliminar producto?\")) {\r\n        return;\r\n      }\r\n      try {\r\n        await API.productos.del(id);\r\n        await load();\r\n      } catch (e) {\r\n        setErr(e.message || \"No se pudo eliminar el producto.\");\r\n      }\r\n    },\r\n    [load]\r\n  );\r\n\r\n  const normalizedQuery = searchQuery.trim().toLowerCase();\r\n  const filteredItems = normalizedQuery\r\n    ? items.filter((pr) => {\r\n        const fields = [pr.id?.toString(), pr.nombre, pr.descripcion, pr.categoria];\r\n        return fields.some((field) => String(field ?? \"\").toLowerCase().includes(normalizedQuery));\r\n      })\r\n    : items;\r\n  const hasSearch = normalizedQuery.length > 0;\r\n\r\n  return (\r\n    <main className=\"flex-grow-1\">\r\n      <div className=\"container-fluid px-4 py-5\">\r\n        <h1 className=\"mb-4 mt-4\">Gestión de Inventario</h1>\r\n        <div className=\"row g-3 align-items-center mb-4\">\r\n          <div className=\"col-12 col-md-8\">\r\n            <form className=\"input-group\" role=\"search\" onSubmit={(e) => e.preventDefault()}>\r\n              <span className=\"input-group-text bg-dark text-white border-secondary\">\r\n                <i className=\"fa-solid fa-magnifying-glass\" aria-hidden=\"true\" />\r\n              </span>\r\n              <input\r\n                type=\"search\"\r\n                className=\"form-control\"\r\n                placeholder=\"Buscar por nombre, descripcion o categoria\"\r\n                value={searchQuery}\r\n                onChange={(e) => setSearchQuery(e.target.value)}\r\n                aria-label=\"Buscar producto en inventario\"\r\n              />\r\n            </form>\r\n          </div>\r\n          <div className=\"col-12 col-md-4 d-grid d-md-flex justify-content-md-end\">\r\n            <Link \r\n              to=\"/admin/productos/nuevo\" \r\n              className=\"btn btn-success\"\r\n              aria-label=\"Añadir nuevo producto o servicio al inventario\"\r\n            >\r\n              <i className=\"fa-solid fa-plus me-2\" aria-hidden=\"true\" />\r\n              Añadir Producto/Servicio\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        {err && (\r\n          <div className=\"alert alert-danger\" role=\"alert\">\r\n            <i className=\"fa-solid fa-exclamation-triangle me-2\" aria-hidden=\"true\" />\r\n            {err}\r\n          </div>\r\n        )}\r\n\r\n        {loading ? (\r\n          <div className=\"text-center py-5\">\r\n            <div className=\"spinner-border text-primary\" role=\"status\">\r\n              <span className=\"visually-hidden\">Cargando productos...</span>\r\n            </div>\r\n            <p className=\"mt-3 text-muted\">Cargando inventario...</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"table-responsive tabla-productos-wrapper mt-3\">\r\n            <table className=\"table table-dark table-striped table-bordered\" aria-label=\"Tabla de productos del inventario\">\r\n            <thead>\r\n              <tr>\r\n                <th scope=\"col\">ID</th>\r\n                <th scope=\"col\">Nombre</th>\r\n                <th scope=\"col\">Precio</th>\r\n                <th scope=\"col\">Descripción</th>\r\n                <th scope=\"col\">Categoría</th>\r\n                <th scope=\"col\">Stock</th>\r\n                <th scope=\"col\">Imagen</th>\r\n                <th scope=\"col\">Acciones</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {filteredItems.map((pr) => {\r\n                const stock = stockDisponible(pr.stock);\r\n                const imageSrc = pr.imagen_url || \"/fitter_logo.png\";\r\n                return (\r\n                  <tr key={pr.id}>\r\n                    <td>{pr.id}</td>\r\n                    <td>{pr.nombre}</td>\r\n                    <td>{formatearPrecio(pr.precio)}</td>\r\n                    <td>{pr.descripcion || \"\"}</td>\r\n                    <td>{pr.categoria || \"\"}</td>\r\n                    <td>{stock}</td>\r\n                    <td>\r\n                      <img src={imageSrc} alt={pr.nombre} style={{ width: 60, height: 60, objectFit: \"cover\", borderRadius: 6 }} />\r\n                    </td>\r\n                    <td className=\"text-center align-middle\">\r\n                      <div className=\"d-flex justify-content-center align-items-center gap-2\">\r\n                        <Link \r\n                          to={`/admin/productos/${pr.id}/editar`} \r\n                          className=\"btn btn-warning btn-action\"\r\n                          aria-label={`Editar ${pr.nombre}`}\r\n                          title=\"Editar\"\r\n                        >\r\n                          <i className=\"fa-solid fa-pen-to-square\" aria-hidden=\"true\" />\r\n                        </Link>\r\n                        <button \r\n                          className=\"btn btn-danger btn-action\" \r\n                          onClick={() => del(pr.id)} \r\n                          aria-label={`Eliminar ${pr.nombre}`}\r\n                          title=\"Eliminar\"\r\n                        >\r\n                          <i className=\"fa-solid fa-trash-can\" aria-hidden=\"true\" />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n              {filteredItems.length === 0 && (\r\n                <tr>\r\n                  <td colSpan={8} className=\"text-center\">\r\n                    {hasSearch ? \"Sin coincidencias\" : \"Sin productos\"}\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        )}\r\n\r\n        {!loading && filteredItems.length > 0 && (\r\n          <div className=\"mt-3 text-muted small\">\r\n            <i className=\"fa-solid fa-box me-2\" aria-hidden=\"true\" />\r\n            Mostrando {filteredItems.length} de {items.length} producto{items.length !== 1 ? 's' : ''}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n","const pesoFormatter = new Intl.NumberFormat(\"es-CL\", {\r\n  style: \"currency\",\r\n  currency: \"CLP\",\r\n  minimumFractionDigits: 0,\r\n  maximumFractionDigits: 0,\r\n});\r\n\r\nexport const formatearPrecio = (valor) => {\r\n  if (valor === null || valor === undefined) {\r\n    return pesoFormatter.format(0);\r\n  }\r\n\r\n  const numero = typeof valor === \"number\" ? valor : Number.parseFloat(valor);\r\n  if (!Number.isFinite(numero)) {\r\n    return pesoFormatter.format(0);\r\n  }\r\n\r\n  const normalizado = Math.round(numero);\r\n  return pesoFormatter.format(normalizado);\r\n};\r\n\r\nexport const formatPrice = formatearPrecio;\r\n"],"names":["stockDisponible","valor","stock","Number","isFinite","TablaProductos","items","setItems","useState","err","setErr","searchQuery","setSearchQuery","loading","setLoading","nav","useNavigate","isAdmin","initialized","refresh","useAuth","load","useCallback","async","data","API","productos","list","e","message","useEffect","catch","del","window","confirm","id","normalizedQuery","trim","toLowerCase","filteredItems","filter","pr","_pr$id","toString","nombre","descripcion","categoria","some","field","String","includes","hasSearch","length","_jsx","className","children","_jsxs","role","onSubmit","preventDefault","type","placeholder","value","onChange","target","Link","to","scope","map","imageSrc","imagen_url","formatearPrecio","precio","src","alt","style","width","height","objectFit","borderRadius","concat","title","onClick","colSpan","pesoFormatter","Intl","NumberFormat","currency","minimumFractionDigits","maximumFractionDigits","undefined","format","numero","parseFloat","normalizado","Math","round"],"sourceRoot":""}