{"version":3,"file":"static/js/172.f4c0b57c.chunk.js","mappings":"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","sources":["pages/ProductoForm.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate, Link, useParams } from \"react-router-dom\";\r\nimport { API } from \"../services/apijs\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport \"../styles/legacy/tabla_productos/style_agregar_producto.css\";\r\n\r\nconst CATEGORIES = [\"Membership\", \"Personal Training\", \"Supplements\", \"Merchandise\"];\r\n\r\nconst normalizaNumero = (valor, fallback = 0) => {\r\n  const num = Number(valor);\r\n  return Number.isFinite(num) ? num : fallback;\r\n};\r\n\r\nexport default function ProductoForm() {\r\n  const nav = useNavigate();\r\n  const { id } = useParams();\r\n  const isEdit = Boolean(id);\r\n  const { isAdmin, initialized, refresh } = useAuth();\r\n  const [f, setF] = useState({ nombre: \"\", precio: 0, descripcion: \"\", categoria: CATEGORIES[0], stock: 0 });\r\n  const [err, setErr] = useState(\"\");\r\n  const [imagenFile, setImagenFile] = useState(null);\r\n  const [preview, setPreview] = useState(null);\r\n  const [loading, setLoading] = useState(isEdit);\r\n\r\n  useEffect(() => {\r\n    if (!initialized) {\r\n      refresh().catch(() => {});\r\n      return;\r\n    }\r\n    if (!isAdmin) {\r\n      nav(\"/login\");\r\n    }\r\n  }, [initialized, isAdmin, nav, refresh]);\r\n\r\n  useEffect(() => {\r\n    if (!isEdit) return;\r\n    let active = true;\r\n    setLoading(true);\r\n    API.productos\r\n      .get(id)\r\n      .then((producto) => {\r\n        if (!active) return;\r\n        setF({\r\n          nombre: producto.nombre || \"\",\r\n          precio: normalizaNumero(producto.precio, 0),\r\n          descripcion: producto.descripcion || \"\",\r\n          categoria: producto.categoria || CATEGORIES[0],\r\n          stock: normalizaNumero(producto.stock, 0),\r\n        });\r\n        if (producto.imagen_url) {\r\n          setPreview(producto.imagen_url);\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        if (!active) return;\r\n        setErr(e.message);\r\n      })\r\n      .finally(() => {\r\n        if (active) setLoading(false);\r\n      });\r\n    return () => {\r\n      active = false;\r\n    };\r\n  }, [id, isEdit]);\r\n\r\n  const save = async (e) => {\r\n    e.preventDefault();\r\n    setErr(\"\");\r\n    try {\r\n      const payload = { ...f };\r\n      if (imagenFile) {\r\n        const fd = new FormData();\r\n        fd.append(\"nombre\", payload.nombre);\r\n        fd.append(\"precio\", payload.precio);\r\n        fd.append(\"descripcion\", payload.descripcion || \"\");\r\n        fd.append(\"categoria\", payload.categoria || \"\");\r\n        fd.append(\"stock\", payload.stock || 0);\r\n        fd.append(\"imagen\", imagenFile, imagenFile.name);\r\n        if (isEdit) {\r\n          await API.productos.update(id, fd);\r\n        } else {\r\n          await API.productos.create(fd);\r\n        }\r\n      } else {\r\n        if (isEdit) {\r\n          await API.productos.update(id, payload);\r\n        } else {\r\n          await API.productos.create(payload);\r\n        }\r\n      }\r\n      nav(\"/admin/productos\");\r\n    } catch (ex) {\r\n      setErr(ex.message);\r\n    }\r\n  };\r\n\r\n  const onFile = (ev) => {\r\n    const file = ev.target.files && ev.target.files[0];\r\n    setImagenFile(file || null);\r\n    if (file) {\r\n      const url = URL.createObjectURL(file);\r\n      setPreview(url);\r\n    } else {\r\n      setPreview(null);\r\n    }\r\n  };\r\n\r\n  const titulo = isEdit ? \"Editar Producto/Servicio\" : \"Añadir Producto/Servicio\";\r\n\r\n  return (\r\n    <div className=\"container mt-5 mb-5\">\r\n      <h1 className=\"text-center mb-5\">{titulo}</h1>\r\n\r\n      {loading ? (\r\n        <div className=\"alert alert-info\">Cargando...</div>\r\n      ) : (\r\n        <form onSubmit={save} className=\"producto-form mb-5\">\r\n          <div className=\"table-responsive\">\r\n            <table className=\"table table-bordered producto-form-table\">\r\n              <tbody>\r\n                <tr>\r\n                  <th scope=\"row\">Nombre</th>\r\n                  <td>\r\n                    <input\r\n                      className=\"form-control\"\r\n                      value={f.nombre}\r\n                      onChange={(e) => setF({ ...f, nombre: e.target.value })}\r\n                      required\r\n                    />\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th scope=\"row\">Precio</th>\r\n                  <td>\r\n                    <input\r\n                      className=\"form-control\"\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      value={f.precio}\r\n                      onChange={(e) => setF({ ...f, precio: normalizaNumero(e.target.value, 0) })}\r\n                      required\r\n                    />\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th scope=\"row\">Descripción</th>\r\n                  <td>\r\n                    <textarea\r\n                      className=\"form-control\"\r\n                      value={f.descripcion}\r\n                      onChange={(e) => setF({ ...f, descripcion: e.target.value })}\r\n                    />\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th scope=\"row\">Categoría</th>\r\n                  <td>\r\n                    <select\r\n                      className=\"form-control\"\r\n                      value={f.categoria}\r\n                      onChange={(e) => setF({ ...f, categoria: e.target.value })}\r\n                    >\r\n                      {CATEGORIES.map((c) => (\r\n                        <option key={c} value={c}>\r\n                          {c}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th scope=\"row\">Stock</th>\r\n                  <td>\r\n                    <input\r\n                      className=\"form-control\"\r\n                      type=\"number\"\r\n                      value={f.stock}\r\n                      onChange={(e) => setF({ ...f, stock: normalizaNumero(e.target.value, 0) })}\r\n                      required\r\n                    />\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <th scope=\"row\">Imagen</th>\r\n                  <td>\r\n                    <input type=\"file\" accept=\"image/*\" onChange={onFile} className=\"form-control\" />\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n\r\n          {err && <div className=\"alert alert-danger\">{err}</div>}\r\n\r\n          {preview && (\r\n            <div className=\"mb-4\">\r\n              <h5>Previsualización</h5>\r\n              <div className=\"preview-container p-3 border rounded\">\r\n                <img src={preview} alt=\"Previsualización del producto\" style={{ maxWidth: 200, maxHeight: 200, objectFit: \"contain\" }} />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"d-flex justify-content-between\">\r\n            <Link to=\"/admin/productos\" className=\"btn btn-secondary\">\r\n              Volver\r\n            </Link>\r\n            <button type=\"submit\" className=\"btn btn-success\">\r\n              Guardar\r\n            </button>\r\n          </div>\r\n        </form>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":["CATEGORIES","normalizaNumero","valor","fallback","arguments","length","undefined","num","Number","isFinite","ProductoForm","nav","useNavigate","id","useParams","isEdit","Boolean","isAdmin","initialized","refresh","useAuth","f","setF","useState","nombre","precio","descripcion","categoria","stock","err","setErr","imagenFile","setImagenFile","preview","setPreview","loading","setLoading","useEffect","catch","active","API","productos","get","then","producto","imagen_url","e","message","finally","titulo","_jsxs","className","children","_jsx","onSubmit","async","preventDefault","payload","_objectSpread","fd","FormData","append","name","update","create","ex","scope","value","onChange","target","required","type","step","map","c","accept","ev","file","files","url","URL","createObjectURL","src","alt","style","maxWidth","maxHeight","objectFit","Link","to"],"sourceRoot":""}