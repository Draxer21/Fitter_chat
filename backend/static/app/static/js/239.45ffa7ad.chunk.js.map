{"version":3,"file":"static/js/239.45ffa7ad.chunk.js","mappings":"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","sources":["pages/LoginPage.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useNavigate, Link, useSearchParams } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { useLocale } from '../contexts/LocaleContext';\r\nimport '../styles/legacy/login/style_login.css';\r\n\r\nconst normalize = (value) => (value || '').trim();\r\n\r\nexport default function LoginPage() {\r\n  const navigate = useNavigate();\r\n  const [params] = useSearchParams();\r\n  const { t } = useLocale();\r\n  const { user, isAuthenticated, login: loginUser, logout: logoutUser, initialized, authenticating } = useAuth();\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [totp, setTotp] = useState('');\r\n  const [backupCode, setBackupCode] = useState('');\r\n  const [needsMfa, setNeedsMfa] = useState(false);\r\n  const [message, setMessage] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!initialized) {\r\n      return;\r\n    }\r\n    if (isAuthenticated) {\r\n      const next = params.get('next');\r\n      if (next) {\r\n        navigate(next, { replace: true });\r\n      }\r\n    }\r\n  }, [initialized, isAuthenticated, navigate, params]);\r\n\r\n  const submit = async (event) => {\r\n    event.preventDefault();\r\n    setMessage('');\r\n    const normalizedUsername = normalize(username).toLowerCase();\r\n    const normalizedPassword = normalize(password);\r\n    if (!normalizedUsername || !normalizedPassword) {\r\n      setMessage(t('login.required'));\r\n      return;\r\n    }\r\n    try {\r\n      setLoading(true);\r\n      const options = {};\r\n      if (totp) options.totp = totp;\r\n      if (backupCode) options.backupCode = backupCode;\r\n      await loginUser(normalizedUsername, normalizedPassword, options);\r\n      setUsername('');\r\n      setPassword('');\r\n      setTotp('');\r\n      setBackupCode('');\r\n      setNeedsMfa(false);\r\n      const next = params.get('next');\r\n      navigate(next || '/admin/productos', { replace: true });\r\n    } catch (error) {\r\n      if (error?.payload?.mfa_required) {\r\n        setNeedsMfa(true);\r\n        setMessage('Se requiere un código TOTP o uno de tus códigos de respaldo para completar el ingreso.');\r\n      } else {\r\n        setMessage(error?.message || t('login.credentials.invalid'));\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    await logoutUser();\r\n  };\r\n\r\n  return (\r\n    <main>\r\n      <div className='d-flex justify-content-center align-items-center' style={{ height: '67.5vh' }}>\r\n        <div className='container mt-5 border mx-auto' style={{ backgroundColor: 'rgba(0,0,0,.904)', width: 500, borderRadius: 13, color: 'white' }}>\r\n          <h2 className='text-center m-4'>{t('login.title')}</h2>\r\n\r\n          {isAuthenticated ? (\r\n            <div className='text-center'>\r\n              <p>\r\n                {t('login.loggedInAs')}: <strong>{user?.full_name || user?.username || 'Usuario'}</strong>\r\n              </p>\r\n              <button className='btn btn-light' onClick={logout}>\r\n                {t('login.logout')}\r\n              </button>\r\n            </div>\r\n          ) : (\r\n            <form className='w-50 mx-auto' onSubmit={submit}>\r\n              <div className='form-group mb-3'>\r\n                <label htmlFor='loginUsername'>{t('login.username.label')}</label>\r\n                <input\r\n                  id='loginUsername'\r\n                  className='form-control'\r\n                  aria-invalid={Boolean(message)}\r\n                  value={username}\r\n                  onChange={(event) => setUsername(event.target.value)}\r\n                  placeholder={t('login.username.placeholder')}\r\n                  autoComplete='username'\r\n                  required\r\n                />\r\n              </div>\r\n              <div className='form-group mb-3'>\r\n                <label htmlFor='loginPassword'>{t('login.password.label')}</label>\r\n                <input\r\n                  type='password'\r\n                  id='loginPassword'\r\n                  className='form-control'\r\n                  aria-invalid={Boolean(message)}\r\n                  value={password}\r\n                  onChange={(event) => setPassword(event.target.value)}\r\n                  placeholder={t('login.password.placeholder')}\r\n                  autoComplete='current-password'\r\n                  required\r\n                />\r\n              </div>\r\n              {(needsMfa || totp || backupCode) && (\r\n                <>\r\n                  <div className='form-group mb-3'>\r\n                    <label htmlFor='loginTotp'>Código TOTP</label>\r\n                    <input\r\n                      id='loginTotp'\r\n                      className='form-control'\r\n                      value={totp}\r\n                      onChange={(event) => setTotp(event.target.value)}\r\n                      placeholder='Ingresa el código de tu app autenticadora'\r\n                      autoComplete='one-time-code'\r\n                    />\r\n                  </div>\r\n                  <div className='form-group mb-3'>\r\n                    <label htmlFor='loginBackup'>Código de respaldo</label>\r\n                    <input\r\n                      id='loginBackup'\r\n                      className='form-control'\r\n                      value={backupCode}\r\n                      onChange={(event) => setBackupCode(event.target.value)}\r\n                      placeholder='Úsalo si no tienes acceso al TOTP'\r\n                      autoComplete='off'\r\n                    />\r\n                    <small className='form-text text-muted'>Puedes dejarlo vacío si usarás el código TOTP.</small>\r\n                  </div>\r\n                </>\r\n              )}\r\n              <div className='text-center mb-2'>\r\n                <span>{t('login.noAccount')} </span>\r\n                <Link to='/registro'>{t('login.gotoRegister')}</Link>\r\n              </div>\r\n              {message && <div className='alert alert-danger mt-2' role='alert' aria-live='assertive'>{message}</div>}\r\n              <div className='d-flex justify-content-center m-3'>\r\n                <button\r\n                  type='submit'\r\n                  className='btn'\r\n                  style={{ backgroundColor: 'black', color: 'white', borderColor: 'rgba(255,255,255,.568)' }}\r\n                  disabled={loading || authenticating}\r\n                >\r\n                  {loading || authenticating ? t('login.loading') : t('login.submit')}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":["normalize","value","trim","LoginPage","navigate","useNavigate","params","useSearchParams","t","useLocale","user","isAuthenticated","login","loginUser","logout","logoutUser","initialized","authenticating","useAuth","username","setUsername","useState","password","setPassword","totp","setTotp","backupCode","setBackupCode","needsMfa","setNeedsMfa","message","setMessage","loading","setLoading","useEffect","next","get","replace","_jsx","children","className","style","height","_jsxs","backgroundColor","width","borderRadius","color","full_name","onClick","async","onSubmit","event","preventDefault","normalizedUsername","toLowerCase","normalizedPassword","options","error","_error$payload","payload","mfa_required","htmlFor","id","Boolean","onChange","target","placeholder","autoComplete","required","type","_Fragment","Link","to","role","borderColor","disabled"],"sourceRoot":""}