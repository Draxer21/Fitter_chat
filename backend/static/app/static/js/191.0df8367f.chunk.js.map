{"version":3,"file":"static/js/191.0df8367f.chunk.js","mappings":"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","sources":["pages/AdminSalesPage.jsx","utils/formatPrice.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { API } from \"../services/apijs\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport { formatearPrecio } from \"../utils/formatPrice\";\r\nimport \"../styles/admin-sales.css\";\r\n\r\nconst formatDate = (iso) => {\r\n  try {\r\n    return new Date(iso).toLocaleDateString();\r\n  } catch (err) {\r\n    return iso;\r\n  }\r\n};\r\n\r\nfunction SummaryCard({ label, value }) {\r\n  return (\r\n    <div className=\"sales-card\">\r\n      <span className=\"sales-card__label\">{label}</span>\r\n      <strong className=\"sales-card__value\">{value}</strong>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction BarChart({ data }) {\r\n  if (!data || data.length === 0) {\r\n    return <p className=\"text-muted\">Sin datos para el rango seleccionado.</p>;\r\n  }\r\n  const max = Math.max(...data.map((item) => item.total || 0));\r\n  return (\r\n    <div className=\"sales-chart\">\r\n      {data.map((item) => (\r\n        <div key={item.date} className=\"sales-chart__item\">\r\n          <div\r\n            className=\"sales-chart__bar\"\r\n            style={{ height: max ? `${Math.max((item.total / max) * 100, 6)}%` : \"6%\" }}\r\n          />\r\n          <span className=\"sales-chart__label\">{formatDate(item.date)}</span>\r\n          <span className=\"sales-chart__value\">{formatearPrecio(item.total)}</span>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function AdminSalesPage() {\r\n  const { isAdmin } = useAuth();\r\n  const [summary, setSummary] = useState(null);\r\n  const [orders, setOrders] = useState([]);\r\n  const [filters, setFilters] = useState({ status: \"\", start: \"\", end: \"\" });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const loadData = async (params = {}) => {\r\n    setLoading(true);\r\n    try {\r\n      const query = new URLSearchParams({ ...params });\r\n      const summaryData = await API.orders.summary(query.toString());\r\n      const listData = await API.orders.list(query.toString());\r\n      setSummary(summaryData);\r\n      setOrders(listData?.orders || []);\r\n      setError(\"\");\r\n    } catch (err) {\r\n      setError(err?.message || \"No pudimos cargar los datos de ventas.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isAdmin) {\r\n      loadData();\r\n    }\r\n  }, [isAdmin]);\r\n\r\n  const handleFilterChange = (event) => {\r\n    const { name, value } = event.target;\r\n    setFilters((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const applyFilters = (event) => {\r\n    event.preventDefault();\r\n    const params = {};\r\n    if (filters.status) params.status = filters.status;\r\n    if (filters.start) params.start = filters.start;\r\n    if (filters.end) params.end = filters.end;\r\n    loadData(params);\r\n  };\r\n\r\n  if (!isAdmin) {\r\n    return <div className=\"container py-5\">No autorizado.</div>;\r\n  }\r\n\r\n  return (\r\n    <main className=\"container py-4 admin-sales\">\r\n      <h1 className=\"mb-4\">Panel de ventas</h1>\r\n      <form className=\"sales-filters\" onSubmit={applyFilters}>\r\n        <div>\r\n          <label className=\"form-label\">Estado</label>\r\n          <select name=\"status\" className=\"form-select\" value={filters.status} onChange={handleFilterChange}>\r\n            <option value=\"\">Todos</option>\r\n            <option value=\"paid\">Pagados</option>\r\n            <option value=\"refunded\">Reembolsados</option>\r\n            <option value=\"cancelled\">Cancelados</option>\r\n          </select>\r\n        </div>\r\n        <div>\r\n          <label className=\"form-label\">Desde</label>\r\n          <input type=\"date\" name=\"start\" className=\"form-control\" value={filters.start} onChange={handleFilterChange} />\r\n        </div>\r\n        <div>\r\n          <label className=\"form-label\">Hasta</label>\r\n          <input type=\"date\" name=\"end\" className=\"form-control\" value={filters.end} onChange={handleFilterChange} />\r\n        </div>\r\n        <button type=\"submit\" className=\"btn btn-dark align-self-end\">Aplicar</button>\r\n      </form>\r\n\r\n      {loading && <div className=\"alert alert-info\">Cargando informacion...</div>}\r\n      {error && <div className=\"alert alert-danger\">{error}</div>}\r\n\r\n      {summary && !loading && !error && (\r\n        <>\r\n          <section className=\"sales-summary\">\r\n            <SummaryCard label=\"Ventas totales\" value={formatearPrecio(summary.total_sales)} />\r\n            <SummaryCard label=\"Ordenes\" value={summary.total_orders} />\r\n            <SummaryCard label=\"Ordenes pagadas\" value={summary.paid_orders} />\r\n            <SummaryCard label=\"Ventas ultimos 30 dias\" value={formatearPrecio(summary.sales_last_30)} />\r\n          </section>\r\n\r\n          <section className=\"sales-chart-section\">\r\n            <h2>Ventas diarias (30 dias)</h2>\r\n            <BarChart data={summary.daily_sales} />\r\n          </section>\r\n\r\n          <section className=\"sales-top-products\">\r\n            <h2>Productos destacados</h2>\r\n            <ul>\r\n              {summary.top_products.map((item) => (\r\n                <li key={item.name}>\r\n                  <strong>{item.name}</strong> - {item.quantity} uds - {formatearPrecio(item.revenue)}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </section>\r\n        </>\r\n      )}\r\n\r\n      <section className=\"sales-table-section\">\r\n        <h2>Ordenes recientes</h2>\r\n        <div className=\"table-responsive\">\r\n          <table className=\"table table-striped align-middle\">\r\n            <thead>\r\n              <tr>\r\n                <th>ID</th>\r\n                <th>Fecha</th>\r\n                <th>Cliente</th>\r\n                <th>Total</th>\r\n                <th>Estado</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {orders.map((order) => (\r\n                <tr key={order.id}>\r\n                  <td>{order.id}</td>\r\n                  <td>{formatDate(order.created_at)}</td>\r\n                  <td>{order.customer_name || \"Invitado\"}</td>\r\n                  <td>{formatearPrecio(order.total_amount)}</td>\r\n                  <td>\r\n                    <span className={`badge bg-${order.status === \"paid\" ? \"success\" : \"secondary\"}`}>\r\n                      {order.status}\r\n                    </span>\r\n                  </td>\r\n                </tr>\r\n              ))}\r\n              {!orders.length && !loading && (\r\n                <tr>\r\n                  <td colSpan={5} className=\"text-center text-muted py-4\">Sin ordenes para los filtros seleccionados.</td>\r\n                </tr>\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n","const pesoFormatter = new Intl.NumberFormat(\"es-CL\", {\r\n  style: \"currency\",\r\n  currency: \"CLP\",\r\n  minimumFractionDigits: 0,\r\n  maximumFractionDigits: 0,\r\n});\r\n\r\nexport const formatearPrecio = (valor) => {\r\n  if (valor === null || valor === undefined) {\r\n    return pesoFormatter.format(0);\r\n  }\r\n\r\n  const numero = typeof valor === \"number\" ? valor : Number.parseFloat(valor);\r\n  if (!Number.isFinite(numero)) {\r\n    return pesoFormatter.format(0);\r\n  }\r\n\r\n  const normalizado = Math.round(numero);\r\n  return pesoFormatter.format(normalizado);\r\n};\r\n\r\nexport const formatPrice = formatearPrecio;\r\n"],"names":["formatDate","iso","Date","toLocaleDateString","err","SummaryCard","_ref","label","value","_jsxs","className","children","_jsx","BarChart","_ref2","data","length","max","Math","map","item","total","style","height","concat","date","formatearPrecio","AdminSalesPage","isAdmin","useAuth","summary","setSummary","useState","orders","setOrders","filters","setFilters","status","start","end","loading","setLoading","error","setError","loadData","async","params","arguments","undefined","query","URLSearchParams","_objectSpread","summaryData","API","toString","listData","list","message","useEffect","handleFilterChange","event","name","target","prev","onSubmit","preventDefault","onChange","type","_Fragment","total_sales","total_orders","paid_orders","sales_last_30","daily_sales","top_products","quantity","revenue","order","id","created_at","customer_name","total_amount","colSpan","pesoFormatter","Intl","NumberFormat","currency","minimumFractionDigits","maximumFractionDigits","valor","format","numero","Number","parseFloat","isFinite","normalizado","round"],"sourceRoot":""}