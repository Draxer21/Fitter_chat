{"version":3,"file":"static/js/869.4614e48f.chunk.js","mappings":"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","sources":["pages/RutinaPage.jsx"],"sourcesContent":["// src/pages/RutinaPage.jsx\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\n\r\nexport default function RutinaPage() {\r\n  const { id: rawId } = useParams();\r\n  const id = decodeURIComponent(String(rawId || \"\"));\r\n  const [loading, setLoading] = useState(true);\r\n  const [rutina, setRutina] = useState(null);\r\n  const [error, setError] = useState(null);\r\n  const [usandoFallback, setUsandoFallback] = useState(false);\r\n  const abortRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    // cancela petición previa si cambia el id\r\n    if (abortRef.current) abortRef.current.abort();\r\n    const controller = new AbortController();\r\n    abortRef.current = controller;\r\n\r\n    (async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n      setUsandoFallback(false);\r\n\r\n      try {\r\n        const res = await fetch(`/chat/routine/${encodeURIComponent(id)}`, {\r\n          signal: controller.signal\r\n        });\r\n        if (cancelled) return;\r\n\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          // defensa: validamos forma mínima\r\n          const sane = saneaRutina(data) || fallbackDesdeId(id);\r\n          setRutina(sane);\r\n          setUsandoFallback(!saneaRutina(data));\r\n        } else {\r\n          setRutina(fallbackDesdeId(id));\r\n          setUsandoFallback(true);\r\n        }\r\n      } catch (e) {\r\n        if (e?.name !== \"AbortError\") {\r\n          setError(\"No se pudo obtener la rutina desde el backend.\");\r\n          // Aún así mostramos algo al usuario\r\n          setRutina(fallbackDesdeId(id));\r\n          setUsandoFallback(true);\r\n        }\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n      controller.abort();\r\n    };\r\n  }, [id]);\r\n\r\n  if (loading) {\r\n    return <main style={{ padding: 24 }}>Cargando rutina…</main>;\r\n  }\r\n\r\n  if (!rutina) {\r\n    return <main style={{ padding: 24 }}>No se encontró la rutina.</main>;\r\n  }\r\n\r\n  const { objetivo, musculo, nivel, ejercicios = [], notas } = rutina;\r\n\r\n  return (\r\n    <main style={{ padding: 24, maxWidth: 840, margin: \"0 auto\" }}>\r\n      <header style={{ marginBottom: 16 }}>\r\n        <h1 style={{ fontSize: 22, fontWeight: 600 }}>\r\n          Rutina: {titulo(musculo)} · {nivel}\r\n        </h1>\r\n        <p style={{ color: \"var(--muted)\" }}>\r\n          Objetivo: <strong>{objetivo}</strong>\r\n        </p>\r\n        <p style={{ color: \"var(--muted)\" }}>ID: {id}</p>\r\n\r\n        {usandoFallback && (\r\n          <div\r\n            role=\"status\"\r\n            style={{\r\n              marginTop: 8,\r\n              padding: \"6px 10px\",\r\n              border: \"1px solid #fde68a\",\r\n              background: \"#fffbeb\",\r\n              color: \"#92400e\",\r\n              borderRadius: 8\r\n            }}\r\n          >\r\n            Mostrando rutina generada localmente (fallback). Cuando expongas\r\n            <code> /chat/routine/:id</code> desde Flask, se cargará la versión del backend.\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div\r\n            role=\"alert\"\r\n            style={{\r\n              marginTop: 8,\r\n              padding: \"6px 10px\",\r\n              border: \"1px solid #fecaca\",\r\n              background: \"#fee2e2\",\r\n              color: \"#991b1b\",\r\n              borderRadius: 8\r\n            }}\r\n          >\r\n            {error}\r\n          </div>\r\n        )}\r\n      </header>\r\n\r\n      <section\r\n        style={{\r\n          background: \"#fafafa\",\r\n          padding: 16,\r\n          borderRadius: 12,\r\n          border: \"1px solid #eee\"\r\n        }}\r\n      >\r\n        <h2 style={{ marginBottom: 8, fontSize: 18, fontWeight: 600 }}>\r\n          Bloques de ejercicio\r\n        </h2>\r\n        <ol style={{ paddingLeft: 18, lineHeight: 1.7 }}>\r\n          {ejercicios.map((e, idx) => (\r\n            <li key={idx}>{e}</li>\r\n          ))}\r\n        </ol>\r\n\r\n        {notas && (\r\n          <>\r\n            <h3 style={{ marginTop: 16, marginBottom: 6, fontWeight: 600 }}>\r\n              Notas\r\n            </h3>\r\n            <p>{notas}</p>\r\n          </>\r\n        )}\r\n      </section>\r\n\r\n      <footer style={{ marginTop: 20, display: \"flex\", gap: 8 }}>\r\n        <Link\r\n          to=\"/\"\r\n          style={{\r\n            padding: \"8px 12px\",\r\n            border: \"1px solid #ccc\",\r\n            borderRadius: 8,\r\n            textDecoration: \"none\",\r\n            color: \"#111\"\r\n          }}\r\n        >\r\n          Volver al chat\r\n        </Link>\r\n        <button\r\n          onClick={() => window.print()}\r\n          style={{\r\n            padding: \"8px 12px\",\r\n            borderRadius: 8,\r\n            background: \"#0d6efd\",\r\n            color: \"white\",\r\n            border: \"none\",\r\n            cursor: \"pointer\"\r\n          }}\r\n        >\r\n          Imprimir / Guardar PDF\r\n        </button>\r\n      </footer>\r\n    </main>\r\n  );\r\n}\r\n\r\n/** ------- Utilidades ------- **/\r\n\r\nfunction titulo(txt) {\r\n  if (!txt) return \"\";\r\n  return txt.slice(0, 1).toUpperCase() + txt.slice(1);\r\n}\r\n\r\nfunction saneaRutina(raw) {\r\n  if (!raw || typeof raw !== \"object\") return null;\r\n  const objetivo = pickStr(raw.objetivo, \"general\");\r\n  const musculo = pickStr(raw.musculo, \"fullbody\");\r\n  const nivel = pickStr(raw.nivel, \"principiante\");\r\n  const ejercicios = Array.isArray(raw.ejercicios)\r\n    ? raw.ejercicios.filter(Boolean)\r\n    : [];\r\n  const notas =\r\n    typeof raw.notas === \"string\" && raw.notas.trim() ? raw.notas : undefined;\r\n\r\n  if (!objetivo || !musculo || !nivel) return null;\r\n  if (ejercicios.length === 0) return null;\r\n\r\n  return { objetivo, musculo, nivel, ejercicios, notas };\r\n}\r\n\r\nfunction pickStr(v, d) {\r\n  return typeof v === \"string\" && v.trim() ? v.trim() : d;\r\n}\r\n\r\n// Fallback local: deriva datos básicos desde el ID \"musculo-nivel-timestamp\"\r\nfunction fallbackDesdeId(id) {\r\n  try {\r\n    const parts = String(id).split(\"-\");\r\n    const musculoRaw = parts.shift();\r\n    const nivelRaw = parts.shift();\r\n    const musculo = (musculoRaw || \"fullbody\").toLowerCase();\r\n    const nivel = (nivelRaw || \"principiante\").toLowerCase();\r\n\r\n    // Catálogo mínimo en front (coherente con backend demo)\r\n    const PLANES = {\r\n      pecho: [\"Press banca 4x8–10\", \"Press inclinado mancuernas 3x10–12\", \"Aperturas 3x12–15\"],\r\n      espalda: [\"Dominadas asistidas 4x6–8\", \"Remo con barra 4x8–10\", \"Jalón al pecho 3x10–12\"],\r\n      piernas: [\"Sentadilla 4x6–8\", \"Prensa 3x10–12\", \"Peso muerto rumano 3x8–10\"],\r\n      hombros: [\"Press militar 4x6–8\", \"Elevaciones laterales 3x12–15\", \"Pájaros 3x12–15\"],\r\n      brazos: [\"Curl barra 4x8–10\", \"Fondos 3x8–10\", \"Curl martillo 3x10–12\"],\r\n      core: [\"Plancha 3x40–60s\", \"Crunch 3x15–20\", \"Elevación de piernas 3x12–15\"],\r\n      fullbody: [\"Sentadilla 3x8\", \"Press banca 3x8\", \"Remo 3x8\", \"Peso muerto 3x5\"]\r\n    };\r\n\r\n    const ejercicios = PLANES[musculo] || PLANES.fullbody;\r\n\r\n    return {\r\n      id,\r\n      objetivo: \"general\",\r\n      musculo,\r\n      nivel,\r\n      ejercicios,\r\n      notas: \"Ajusta volumen e intensidad según tolerancia. Hidrátate y cuida técnica.\"\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"names":["RutinaPage","id","rawId","useParams","decodeURIComponent","String","loading","setLoading","useState","rutina","setRutina","error","setError","usandoFallback","setUsandoFallback","abortRef","useRef","useEffect","cancelled","current","abort","controller","AbortController","res","fetch","concat","encodeURIComponent","signal","ok","data","json","sane","saneaRutina","fallbackDesdeId","e","name","_jsx","style","padding","children","objetivo","musculo","nivel","ejercicios","notas","_jsxs","maxWidth","margin","marginBottom","fontSize","fontWeight","titulo","color","role","marginTop","border","background","borderRadius","paddingLeft","lineHeight","map","idx","_Fragment","display","gap","Link","to","textDecoration","onClick","window","print","cursor","txt","slice","toUpperCase","raw","pickStr","Array","isArray","filter","Boolean","trim","undefined","length","v","d","parts","split","musculoRaw","shift","nivelRaw","toLowerCase","PLANES","pecho","espalda","piernas","hombros","brazos","core","fullbody","_unused"],"sourceRoot":""}