import { createContext, useContext, useEffect, useMemo, useState } from "react";

const SUPPORTED_LOCALES = ["es", "en"];

const MESSAGES = {
  es: {
    "nav.home": "Inicio",
    "nav.products": "Productos y Servicios",
    "nav.products.memberships": "Membresías",
    "nav.products.training": "Entrenamiento Personal",
    "nav.products.supplements": "Suplementos",
    "nav.products.merch": "Mercancía",
    "nav.support": "Soporte",
    "nav.logout": "Cerrar sesión",
    "nav.greeting": "Hola",
    "nav.admin.inventory": "Control de Inventario",
    "nav.admin.addProduct": "Añadir Producto/Servicio",
    "nav.logout.confirmTitle": "Confirmar cierre de sesión",
    "nav.logout.confirmBody": "¿Estás seguro de que deseas cerrar sesión?",
    "nav.logout.cancel": "Cancelar",
    "nav.logout.accept": "Confirmar",
    "nav.login.cta": "Inscríbete ya",
    "nav.language": "Idioma",
    "nav.language.switch": "ES / EN",
    "support.title": "Contactar Soporte",
    "support.ticket.title": "Ticket de Soporte",
    "support.ticket.email": "Correo electrónico",
    "support.ticket.desc": "Describe tu problema",
    "support.ticket.submit": "Enviar",
    "login.title": "Ingreso Usuario",
    "login.username.label": "Nombre de usuario",
    "login.username.placeholder": "tu_usuario",
    "login.password.label": "Contraseña",
    "login.password.placeholder": "Contraseña",
    "login.submit": "Iniciar Sesión",
    "login.loading": "Iniciando...",
    "login.required": "Debes ingresar usuario y contraseña",
    "login.error": "No fue posible iniciar sesión",
    "login.credentials.invalid": "Credenciales inválidas.",
    "login.loggedInAs": "Ingreso usuario",
    "login.logout": "Cerrar sesión",
    "login.noAccount": "¿No tienes cuenta?",
    "login.gotoRegister": "Regístrate aquí",
    "register.title": "Crear Cuenta",
    "register.fullname": "Nombre completo",
    "register.username": "Nombre de usuario",
    "register.email": "Correo electrónico",
    "register.password": "Contraseña",
    "register.password.confirm": "Confirmar contraseña",
    "register.submit": "Registrarse",
    "register.loading": "Registrando...",
    "register.haveAccount": "¿Ya tienes una cuenta?",
    "register.gotoLogin": "Inicia sesión aquí",
    "register.error.required": "Nombre, usuario, correo y password son obligatorios",
    "register.error.email": "El correo no es válido",
    "register.error.username": "El usuario debe tener entre 3 y 32 caracteres y solo contener letras, números, guion y guion bajo",
    "register.error.passwordLength": "La contraseña debe tener al menos 6 caracteres",
    "register.error.passwordMismatch": "Las contraseñas no coinciden",
    "register.success": "Registro exitoso, redirigiendo a iniciar sesión...",
    "profile.title": "Mi información",
    "profile.subtitle": "Comparte tus datos básicos para personalizar mejor tus rutinas, recomendaciones y plan de alimentación.",
    "profile.highlight.eyebrow": "Perfil dinámico",
    "profile.highlight.title": "Ajusta tus datos en segundos",
    "profile.highlight.subtitle": "Tus metas y rutinas se recalculan cada vez que guardas la información.",
    "profile.stats.bmiLabel": "Tu IMC estimado",
    "profile.stats.bmiNote": "Lo usamos solo como referencia rápida.",
    "profile.bmi.table.title": "Clasificación de IMC",
    "profile.bmi.table.subtitle": "Valores de referencia generales (OMS).",
    "profile.bmi.table.status": "Estado",
    "profile.bmi.table.range": "Rango",
    "profile.bmi.category.underweight": "Bajo peso",
    "profile.bmi.category.healthy": "Peso saludable",
    "profile.bmi.category.overweight": "Sobrepeso",
    "profile.bmi.category.obesity": "Obesidad",
    "profile.bmi.range.underweight": "Menos de 18.5",
    "profile.bmi.range.healthy": "18.5 - 24.9",
    "profile.bmi.range.overweight": "25.0 - 29.9",
    "profile.bmi.range.obesity": "30.0 o más",
    "profile.messages.authRequired": "Necesitas iniciar sesión para editar tu perfil.",
    "profile.messages.authButton": "Ir al inicio de sesión",
    "profile.alerts.success": "Perfil actualizado correctamente.",
    "profile.alerts.error": "No pudimos guardar tus datos.",
    "profile.alerts.loadError": "Error al cargar el perfil.",
    "profile.fields.weight": "Peso (kg)",
    "profile.fields.height": "Altura (cm)",
    "profile.fields.age": "Edad",
    "profile.fields.sex": "Sexo",
    "profile.fields.activity": "Nivel de actividad",
    "profile.fields.goal": "Objetivo principal",
    "profile.fields.preferredMuscle": "Grupo muscular preferido",
    "profile.fields.allergies": "Alergias",
    "profile.fields.medical": "Padecimientos",
    "profile.fields.notes": "Notas adicionales",
    "profile.placeholders.allergies": "Ej. lactosa, frutos secos",
    "profile.placeholders.medical": "Indica enfermedades, lesiones o condiciones médicas relevantes",
    "profile.placeholders.notes": "Objetivos específicos, limitaciones u otros comentarios",
    "profile.actions.save": "Guardar",
    "profile.actions.saving": "Guardando...",
    "profile.helper.notice": "Los cambios impactarán en tus recomendaciones de rutina y dieta.",
    "profile.sex.select": "Seleccionar",
    "profile.sex.female": "Femenino",
    "profile.sex.male": "Masculino",
    "profile.sex.other": "Otro",
    "profile.activity.select": "Seleccionar",
    "profile.activity.sedentario": "Sedentario",
    "profile.activity.ligero": "Ligero",
    "profile.activity.moderado": "Moderado",
    "profile.activity.intenso": "Intenso",
    "profile.activity.atleta": "Atleta",
    "profile.goal.perder_grasa": "Perder grasa",
    "profile.goal.mantener": "Mantener",
    "profile.goal.ganar_masa": "Ganar masa",
    "profile.goal.rendimiento": "Rendimiento",
    "profile.goal.select": "Seleccionar",
    "profile.muscle.select": "Seleccionar",
    "profile.muscle.chest": "Pecho",
    "profile.muscle.back": "Espalda",
    "profile.muscle.legs": "Piernas",
    "profile.muscle.shoulders": "Hombros",
    "profile.muscle.arms": "Brazos",
    "profile.muscle.core": "Core",
    "profile.muscle.fullbody": "Fullbody",
    "profile.muscle.cardio": "Cardio",
    "home.hero.title.muted": "CONSTRUYE",
    "home.hero.title.highlight": "TU CUERPO",
    "home.hero.subtitle.prefix": "TRANSFORMA",
    "home.hero.subtitle.strong": "TU VIDA",
    "home.hero.description": "Planes personalizados, tecnología inteligente y coaches reales listos para acompañarte.",
    "home.hero.cta": "PRUEBA GRATIS",
    "home.hero.feature.training.title": "EL MEJOR ENTRENAMIENTO",
    "home.hero.feature.training.desc": "Entrenamientos diseñados para maximizar tus resultados con profesionales a tu lado.",
    "home.hero.feature.ai.title": "IA ENTRENADA",
    "home.hero.feature.ai.desc": "Nuestra IA aprende de tus progresos y te recomienda el siguiente paso.",
    "home.hero.feature.gym.title": "GIMNASIO DE ALTA TECNOLOGÍA",
    "home.hero.feature.gym.desc": "Instalaciones modernas y equipadas con la última tecnología.",
    "home.hero.feature.community.title": "MIEMBROS SATISFECHOS",
    "home.hero.feature.community.desc": "Únete a una comunidad motivadora y comprueba los resultados por ti mismo.",
    "home.offers.title": "Nuestras Ofertas",
    "home.offers.in": "en",
    "home.offers.loading": "Cargando...",
    "home.offers.errorPrefix": "Error:",
    "home.offers.categoryLabel": "Categoría",
    "home.offers.availabilityLabel": "Disponibilidad",
    "home.offers.priceLabel": "Precio",
    "home.offers.button.outOfStock": "Sin stock",
    "home.offers.button.addToCart": "Añadir al carrito",
    "home.offers.empty": "No hay productos o servicios disponibles.",
    "memberships.title": "Nuestras Membresías",
    "memberships.selectPlan": "Elegir plan",
    "memberships.period.perMonth": "/mes",
    "memberships.plans.basic.name": "BÁSICO",
    "memberships.plans.basic.feature.1": "Acceso ilimitado a todas las sedes",
    "memberships.plans.basic.feature.2": "Entrenamiento libre",
    "memberships.plans.basic.feature.3": "Clases grupales",
    "memberships.plans.basic.feature.4": "Acceso a sauna y duchas",
    "memberships.plans.premium.name": "PREMIUM",
    "memberships.plans.premium.feature.1": "Todo lo del Básico",
    "memberships.plans.premium.feature.2": "Entrenamiento personalizado",
    "memberships.plans.premium.feature.3": "Acceso a zona VIP",
    "memberships.plans.premium.feature.4": "Bebidas energéticas ilimitadas",
    "memberships.plans.premium.feature.5": "Descuentos en suplementos",
    "memberships.plans.black.name": "BLACK",
    "memberships.plans.black.feature.1": "Todo lo del Premium",
    "memberships.plans.black.feature.2": "Acceso 24/7",
    "memberships.plans.black.feature.3": "Masajista personal",
    "memberships.plans.black.feature.4": "Nutricionista incluido",
    "memberships.plans.black.feature.5": "Invitados ilimitados",
  },
  en: {
    "nav.home": "Home",
    "nav.products": "Products & Services",
    "nav.products.memberships": "Memberships",
    "nav.products.training": "Personal Training",
    "nav.products.supplements": "Supplements",
    "nav.products.merch": "Merchandise",
    "nav.support": "Support",
    "nav.logout": "Log out",
    "nav.greeting": "Hello",
    "nav.admin.inventory": "Inventory Control",
    "nav.admin.addProduct": "Add Product/Service",
    "nav.logout.confirmTitle": "Confirm log out",
    "nav.logout.confirmBody": "Are you sure you want to sign out?",
    "nav.logout.cancel": "Cancel",
    "nav.logout.accept": "Confirm",
    "nav.login.cta": "Join now",
    "nav.language": "Language",
    "nav.language.switch": "ES / EN",
    "support.title": "Contact Support",
    "support.ticket.title": "Support ticket",
    "support.ticket.email": "Email address",
    "support.ticket.desc": "Describe your issue",
    "support.ticket.submit": "Submit",
    "login.title": "User Login",
    "login.username.label": "Username",
    "login.username.placeholder": "your_username",
    "login.password.label": "Password",
    "login.password.placeholder": "Password",
    "login.submit": "Log In",
    "login.loading": "Signing in...",
    "login.required": "Username and password are required",
    "login.error": "Unable to sign in",
    "login.credentials.invalid": "Invalid credentials.",
    "login.loggedInAs": "Signed in as",
    "login.logout": "Sign out",
    "login.noAccount": "Don't have an account?",
    "login.gotoRegister": "Sign up here",
    "register.title": "Create Account",
    "register.fullname": "Full name",
    "register.username": "Username",
    "register.email": "Email",
    "register.password": "Password",
    "register.password.confirm": "Confirm password",
    "register.submit": "Register",
    "register.loading": "Registering...",
    "register.haveAccount": "Already have an account?",
    "register.gotoLogin": "Log in here",
    "register.error.required": "Name, username, email and password are required",
    "register.error.email": "Email is not valid",
    "register.error.username": "Username must be 3-32 characters and only include letters, numbers, dash or underscore",
    "register.error.passwordLength": "Password must be at least 6 characters long",
    "register.error.passwordMismatch": "Passwords do not match",
    "register.success": "Registration successful, redirecting to login...",
    "profile.title": "My information",
    "profile.subtitle": "Share a few basics to personalize your routines, recommendations and nutrition plan.",
    "profile.highlight.eyebrow": "Dynamic profile",
    "profile.highlight.title": "Tune your data in seconds",
    "profile.highlight.subtitle": "Goals and routines refresh every time you hit save.",
    "profile.stats.bmiLabel": "Estimated BMI",
    "profile.stats.bmiNote": "We only use it as a quick reference.",
    "profile.bmi.table.title": "BMI classification",
    "profile.bmi.table.subtitle": "General WHO reference ranges.",
    "profile.bmi.table.status": "Status",
    "profile.bmi.table.range": "Range",
    "profile.bmi.category.underweight": "Underweight",
    "profile.bmi.category.healthy": "Healthy weight",
    "profile.bmi.category.overweight": "Overweight",
    "profile.bmi.category.obesity": "Obesity",
    "profile.bmi.range.underweight": "Below 18.5",
    "profile.bmi.range.healthy": "18.5 - 24.9",
    "profile.bmi.range.overweight": "25.0 - 29.9",
    "profile.bmi.range.obesity": "30.0 or higher",
    "profile.messages.authRequired": "You must sign in to edit your profile.",
    "profile.messages.authButton": "Go to sign in",
    "profile.alerts.success": "Profile updated successfully.",
    "profile.alerts.error": "We couldn't save your data.",
    "profile.alerts.loadError": "Error loading the profile.",
    "profile.fields.weight": "Weight (kg)",
    "profile.fields.height": "Height (cm)",
    "profile.fields.age": "Age",
    "profile.fields.sex": "Sex",
    "profile.fields.activity": "Activity level",
    "profile.fields.goal": "Primary goal",
    "profile.fields.preferredMuscle": "Preferred muscle group",
    "profile.fields.allergies": "Allergies",
    "profile.fields.medical": "Conditions",
    "profile.fields.notes": "Additional notes",
    "profile.placeholders.allergies": "e.g. lactose, nuts",
    "profile.placeholders.medical": "Add injuries, illnesses or other relevant conditions",
    "profile.placeholders.notes": "Specific goals, limitations or extra context",
    "profile.actions.save": "Save",
    "profile.actions.saving": "Saving...",
    "profile.helper.notice": "Changes will update your routine and diet recommendations.",
    "profile.sex.select": "Select",
    "profile.sex.female": "Female",
    "profile.sex.male": "Male",
    "profile.sex.other": "Other",
    "profile.activity.select": "Select",
    "profile.activity.sedentario": "Sedentary",
    "profile.activity.ligero": "Light",
    "profile.activity.moderado": "Moderate",
    "profile.activity.intenso": "Intense",
    "profile.activity.atleta": "Athlete",
    "profile.goal.perder_grasa": "Fat loss",
    "profile.goal.mantener": "Maintain",
    "profile.goal.ganar_masa": "Gain muscle",
    "profile.goal.rendimiento": "Performance",
    "profile.goal.select": "Select",
    "profile.muscle.select": "Select",
    "profile.muscle.chest": "Chest",
    "profile.muscle.back": "Back",
    "profile.muscle.legs": "Legs",
    "profile.muscle.shoulders": "Shoulders",
    "profile.muscle.arms": "Arms",
    "profile.muscle.core": "Core",
    "profile.muscle.fullbody": "Full body",
    "profile.muscle.cardio": "Cardio",
    "home.hero.title.muted": "BUILD",
    "home.hero.title.highlight": "YOUR BODY",
    "home.hero.subtitle.prefix": "TRANSFORM",
    "home.hero.subtitle.strong": "YOUR LIFE",
    "home.hero.description": "Personalized plans, smart tech and real coaches ready to guide you.",
    "home.hero.cta": "TRY IT FREE",
    "home.hero.feature.training.title": "ELITE TRAINING",
    "home.hero.feature.training.desc": "Workouts engineered to maximize your results with pros on your side.",
    "home.hero.feature.ai.title": "AI COACHING",
    "home.hero.feature.ai.desc": "Our AI learns from your progress and recommends the next best move.",
    "home.hero.feature.gym.title": "HIGH-TECH GYM",
    "home.hero.feature.gym.desc": "Modern facilities packed with the latest technology.",
    "home.hero.feature.community.title": "HAPPY MEMBERS",
    "home.hero.feature.community.desc": "Join a motivating community and see the results for yourself.",
    "home.offers.title": "Our Offers",
    "home.offers.in": "in",
    "home.offers.loading": "Loading...",
    "home.offers.errorPrefix": "Error:",
    "home.offers.categoryLabel": "Category",
    "home.offers.availabilityLabel": "Availability",
    "home.offers.priceLabel": "Price",
    "home.offers.button.outOfStock": "Out of stock",
    "home.offers.button.addToCart": "Add to cart",
    "home.offers.empty": "No products or services available.",
    "memberships.title": "Our Memberships",
    "memberships.selectPlan": "Choose plan",
    "memberships.period.perMonth": "/month",
    "memberships.plans.basic.name": "BASIC",
    "memberships.plans.basic.feature.1": "Unlimited access to every location",
    "memberships.plans.basic.feature.2": "Open gym training",
    "memberships.plans.basic.feature.3": "Group classes",
    "memberships.plans.basic.feature.4": "Sauna and showers access",
    "memberships.plans.premium.name": "PREMIUM",
    "memberships.plans.premium.feature.1": "Everything in Basic",
    "memberships.plans.premium.feature.2": "Personalized coaching",
    "memberships.plans.premium.feature.3": "VIP area access",
    "memberships.plans.premium.feature.4": "Unlimited energy drinks",
    "memberships.plans.premium.feature.5": "Supplement discounts",
    "memberships.plans.black.name": "BLACK",
    "memberships.plans.black.feature.1": "Everything in Premium",
    "memberships.plans.black.feature.2": "24/7 access",
    "memberships.plans.black.feature.3": "Personal masseuse",
    "memberships.plans.black.feature.4": "Nutritionist included",
    "memberships.plans.black.feature.5": "Unlimited guests",
  },
};

const LocaleContext = createContext(null);

const detectInitialLocale = () => {
    if (typeof window === "undefined") {
      return "es";
    }
    const stored = window.localStorage.getItem("app_locale");
    if (stored && SUPPORTED_LOCALES.includes(stored)) {
      return stored;
    }
    const nav = window.navigator?.language || "es";
    const normalized = nav.slice(0, 2).toLowerCase();
    return SUPPORTED_LOCALES.includes(normalized) ? normalized : "es";
};

export function LocaleProvider({ children }) {
  const [locale, setLocale] = useState(detectInitialLocale);

  useEffect(() => {
    if (typeof window !== "undefined") {
      window.localStorage.setItem("app_locale", locale);
    }
    if (typeof document !== "undefined") {
      document.documentElement.lang = locale;
    }
  }, [locale]);

  const value = useMemo(() => {
    const fallback = MESSAGES.es;
    const bundle = MESSAGES[locale] ?? fallback;
    return {
      locale,
      setLocale,
      t: (key) => bundle[key] ?? fallback[key] ?? key,
      messages: bundle,
    };
  }, [locale]);

  return <LocaleContext.Provider value={value}>{children}</LocaleContext.Provider>;
}

export function useLocale() {
  const ctx = useContext(LocaleContext);
  if (!ctx) {
    throw new Error("useLocale must be used within a LocaleProvider");
  }
  return ctx;
}

export { SUPPORTED_LOCALES };
